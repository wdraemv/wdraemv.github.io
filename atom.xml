<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>风不及你甜</title>
  
  <subtitle>迷迷糊糊才是真</subtitle>
  <link href="http://example.com/atom.xml" rel="self"/>
  
  <link href="http://example.com/"/>
  <updated>2021-08-20T08:03:05.500Z</updated>
  <id>http://example.com/</id>
  
  <author>
    <name>wdraemv</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Xposed框架 反射大师</title>
    <link href="http://example.com/2021/08/20/cccccaa/"/>
    <id>http://example.com/2021/08/20/cccccaa/</id>
    <published>2021-08-20T07:39:52.000Z</published>
    <updated>2021-08-20T08:03:05.500Z</updated>
    
    <content type="html"><![CDATA[<h2 id><a href="#" class="headerlink" title></a></h2><h2 id="安装Xposed框架"><a href="#安装Xposed框架" class="headerlink" title="安装Xposed框架"></a>安装Xposed框架</h2><p>官网下载地址：<a href="https://repo.xposed.info/module/de.robv.android.xposed.installer">https://repo.xposed.info/module/de.robv.android.xposed.installer</a></p><p>下载之后直接拉进模拟器，安装</p><p><img src="/2021/08/20/cccccaa/1.PNG" alt="1"></p><p>一开始框架会显示没有安装Xposed，我这是已经安装好的，进入框架</p><p><img src="/2021/08/20/cccccaa/2.PNG" alt="2"></p><p>安装/更新，会请求root权限，同意即可，这样Xposed就安装好了</p><h2 id="安装反射大师"><a href="#安装反射大师" class="headerlink" title="安装反射大师"></a>安装反射大师</h2><p>反射大师是一个支持一键脱壳的神器，很好用哦！</p><p>先下载反射大师<br> 下载地址：<a href="https://pan.baidu.com/s/1ALN5n9rsfrV1lqWgaXXY2A%EF%BC%88%E6%8F%90%E5%8F%96%E7%A0%81%EF%BC%9Ah5nc%EF%BC%89">https://pan.baidu.com/s/1ALN5n9rsfrV1lqWgaXXY2A（提取码：h5nc）</a></p><p>下载好后直接安装</p><p><img src="/2021/08/20/cccccaa/8.PNG" alt="8"></p><p>模块没有激活，点击模块管理</p><p><img src="/2021/08/20/cccccaa/3.PNG" alt="3"></p><p>勾选选项，然后重启模拟器即可</p><h2 id="具体脱壳步骤"><a href="#具体脱壳步骤" class="headerlink" title="具体脱壳步骤"></a>具体脱壳步骤</h2><h3 id="1、用反射大师打开待脱壳的App"><a href="#1、用反射大师打开待脱壳的App" class="headerlink" title="1、用反射大师打开待脱壳的App"></a>1、用反射大师打开待脱壳的App</h3><p><img src="/2021/08/20/cccccaa/4.PNG" alt="4"></p><p>点击软件，选择这个软件，然后再打开他</p><h3 id="2、脱壳"><a href="#2、脱壳" class="headerlink" title="2、脱壳"></a>2、脱壳</h3><p><img src="/2021/08/20/cccccaa/6.PNG" alt="6"></p><p>点击屏幕中间的六芒星,选当前Activity</p><p><img src="/2021/08/20/cccccaa/7.PNG" alt="7"></p><p>写出DEX,保存即可</p><p>我们利用adb连接模拟器，adb connect ip+模拟器端口，我用的是夜神模拟器，可以在Nox\bin\BignoxVMS\nox中的nox.vbox查找，找到guestport=”5555的就是</p><p><img src="/2021/08/20/cccccaa/11.PNG" alt="11"></p><p>使用<code>adb</code>连接模拟器并使用<code>adb pull +文件路径</code>这条命令导出刚刚脱壳的</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id&gt;&lt;a href=&quot;#&quot; class=&quot;headerlink&quot; title&gt;&lt;/a&gt;&lt;/h2&gt;&lt;h2 id=&quot;安装Xposed框架&quot;&gt;&lt;a href=&quot;#安装Xposed框架&quot; class=&quot;headerlink&quot; title=&quot;安装Xposed框架&quot;&gt;&lt;/a&gt;安装X</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>基址重定位表</title>
    <link href="http://example.com/2021/08/16/%E5%9F%BA%E5%9D%80%E9%87%8D%E5%AE%9A%E4%BD%8D%E8%A1%A8/"/>
    <id>http://example.com/2021/08/16/%E5%9F%BA%E5%9D%80%E9%87%8D%E5%AE%9A%E4%BD%8D%E8%A1%A8/</id>
    <published>2021-08-16T08:28:09.000Z</published>
    <updated>2021-08-16T08:48:14.041Z</updated>
    
    <content type="html"><![CDATA[<h1 id="基址重定位表"><a href="#基址重定位表" class="headerlink" title="基址重定位表"></a>基址重定位表</h1><h2 id="PE重定位"><a href="#PE重定位" class="headerlink" title="PE重定位"></a>PE重定位</h2><p>向进程的虚拟内存加载PE文件(EXE/DLL/SYS)时，文件会被加载到PE头的ImageBase所指的地址处。若加载的是DLL ( SYS)文件，且在ImageBase位置处已经加载了其他DLL (SYS)文件，那么PE装载器就会将其加载到其他未被占用的空间。这就涉及PE文件重定位的问题，PE重定位是指PE文件无法加载到ImageBase所指位置,而是被加载到其他地址时发生的一系列的处理行为。</p><h3 id="DLL-SYS"><a href="#DLL-SYS" class="headerlink" title="DLL/SYS"></a>DLL/SYS</h3><p>A.DLL被加载到TEST.EXE进程的10000000地址处。此后，B.DLL试图加载到相同地址(（ 10000000 )时，PE装载器将B.DLL加载到另一个尚未被占用的地址（3CO00000)处。</p><p><img src="/2021/08/16/%E5%9F%BA%E5%9D%80%E9%87%8D%E5%AE%9A%E4%BD%8D%E8%A1%A8/1.PNG" alt="1"></p><h3 id="EXE"><a href="#EXE" class="headerlink" title="EXE"></a>EXE</h3><p>创建好进程后，EXE文件会首先加载到内存，所以在EXE中无须考虑重定位的问题。但是Windows Vista之后的版本引入了ASLR安全机制，每次运行EXE文件都会被加载到随机地址，这样大大增强了系统安全性。</p><h2 id="PE重定位的基本原理："><a href="#PE重定位的基本原理：" class="headerlink" title="PE重定位的基本原理："></a>PE重定位的基本原理：</h2><p>1、在应用程序中查找硬编码的地址位置；</p><p>2、读取值后，减去ImageBase（VA转换为RVA）；</p><p>3、加上实际加载地址（RVA转换为VA）。</p><h2 id="基址重定位表："><a href="#基址重定位表：" class="headerlink" title="基址重定位表："></a>基址重定位表：</h2><p>基址重定位表位于PE头的DataDirectory数组的第六个元素（索引为5），如图：</p><p><img src="/2021/08/16/%E5%9F%BA%E5%9D%80%E9%87%8D%E5%AE%9A%E4%BD%8D%E8%A1%A8/2.PNG" alt="2"></p><p>其地址为0002F000，查看一下：</p><p><img src="/2021/08/16/%E5%9F%BA%E5%9D%80%E9%87%8D%E5%AE%9A%E4%BD%8D%E8%A1%A8/3.PNG" alt="3"></p><p>如图罗列了硬编码地址的偏移。</p><p>基址重定位表是IMAGE_BASE_RELOCATION结构体数组，其中第一个成员为VirtualAddress如地址2F000的值，第二个成员为SizeOfBlock如地址2F004的值，第三个成员为TypeOffset数组如2F008地址以下的值，以注释的形式存在，表示该结构体之下会出现WORD类型的数组，并且该数组元素的值就是硬编码在程序中的地址偏移。</p><h2 id="基址重定位表的分析方法："><a href="#基址重定位表的分析方法：" class="headerlink" title="基址重定位表的分析方法："></a>基址重定位表的分析方法：</h2><p>如上图，VirtualAddress的值为1000，SizeOfBlock的值为150，即TypeOffset数组的基准地址为RVA 1000，块的总大小为150。其中，TypeOffset值为2字节（16位）大小，由4位的Type和12位的Offset组成，比如TypeOffset数组的第一个元素值为3420，其中高4位的值“3”（IMAGE_REL_BASED_HIGHLOW）为Type，一般为PE文件，而64位的PE文件常见值为“A”，低12位是真正的位移、其值为420，下面公式计算程序中硬编码地址的偏移：</p><p>VirtualAddress + Offset = 1000 + 420 = 1420（RVA）</p><p>查看1420偏移处（程序被加载到00330000地址处、故RVA 1420即VA 00331420）是否存在要执行PE重定位操作的硬编码地址：</p><p><img src="/2021/08/16/%E5%9F%BA%E5%9D%80%E9%87%8D%E5%AE%9A%E4%BD%8D%E8%A1%A8/4.PNG" alt="4"></p><p>运行notepad.exe程序，假设其被加载到00330000。</p><p>1、查找程序中硬编码地址的位置：</p><p>使用PEView查看RVAV 1420处的内容：</p><p>可以看到，RVAV 1420处保存着程序硬编码地址值010010C4。</p><p>2、读取值后，减去ImageBase值（VA转换为RVA）：</p><p>010010C4 - 01000000 = 10C4</p><p>3、加上实际加载地址（RVA转换为VA）：</p><p>10C4 + 00330000 = 003310C4</p><p>可以看到，和上图硬编码地址一致。</p><p>对于程序内硬编码的地址，PE装载器都会做如上处理，然后将值覆盖到同一位置。若TypeOffset值为0，则表明一个IMAGE_BASE_RELOCATION结构体结束。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;基址重定位表&quot;&gt;&lt;a href=&quot;#基址重定位表&quot; class=&quot;headerlink&quot; title=&quot;基址重定位表&quot;&gt;&lt;/a&gt;基址重定位表&lt;/h1&gt;&lt;h2 id=&quot;PE重定位&quot;&gt;&lt;a href=&quot;#PE重定位&quot; class=&quot;headerlink&quot; title=</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>BUU-reverse4</title>
    <link href="http://example.com/2021/08/15/BUU-reverse3-1/"/>
    <id>http://example.com/2021/08/15/BUU-reverse3-1/</id>
    <published>2021-08-15T08:02:22.000Z</published>
    <updated>2021-08-15T08:15:44.363Z</updated>
    
    <content type="html"><![CDATA[<h1 id="FlareOn5-Ultimate-Minesweeper"><a href="#FlareOn5-Ultimate-Minesweeper" class="headerlink" title="[FlareOn5]Ultimate Minesweeper"></a>[FlareOn5]Ultimate Minesweeper</h1><p>打开发现是一个扫雷的游戏，一点都是雷。猜测这个是.NET文件，用dnspy打开</p><p>找到主函数。</p><p><img src="/2021/08/15/BUU-reverse3-1/7.PNG" alt="7"></p><p>点进去，发现有一个<code>GetKey()</code>函数，估计这个函数就是输出flag的函数了。</p><p><img src="/2021/08/15/BUU-reverse3-1/6.PNG" alt="6"></p><p>通过函数内的调用找到判断的地方</p><p><img src="/2021/08/15/BUU-reverse3-1/hexo\source_posts\BUU-reverse3-1\5.PNG" alt="5"></p><p>通过分析代码可以知到上图中的第一个if语句是用来输出fail的（也就是踩到雷之后，游戏结束。）我们可以直接把判断的地方注释掉，踩到雷就不会结束</p><p><img src="/2021/08/15/BUU-reverse3-1/4.PNG" alt="4"></p><p>保存运行，疯狂点</p><p><img src="/2021/08/15/BUU-reverse3-1/3.PNG" alt="3"></p><p>3个8的地方记住，到原来的程序中点出来，就可以得到flag</p><p><img src="/2021/08/15/BUU-reverse3-1/8.PNG" alt="8"></p><h1 id="FlareOn1-Bob-Doge"><a href="#FlareOn1-Bob-Doge" class="headerlink" title="[FlareOn1]Bob Doge"></a>[FlareOn1]Bob Doge</h1><p>先安装一下程序，32位程序，c++写的，无壳</p><p><img src="/2021/08/15/BUU-reverse3-1/11.PNG" alt="11"></p><p>试着运行一下</p><p><img src="/2021/08/15/BUU-reverse3-1/99.PNG" alt="99"></p><p>dnspy打开,找到DECODE的地方</p><p><img src="/2021/08/15/BUU-reverse3-1/13.PNG" alt="13"></p><p>程序进行了三次运算，得到了text，text2和text3，最后回显text3。 直接在函数末尾下断 运行 截取到flag</p><p><img src="/2021/08/15/BUU-reverse3-1/12.PNG" alt="12"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;FlareOn5-Ultimate-Minesweeper&quot;&gt;&lt;a href=&quot;#FlareOn5-Ultimate-Minesweeper&quot; class=&quot;headerlink&quot; title=&quot;[FlareOn5]Ultimate Minesweeper&quot;&gt;&lt;/</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>运行时压缩</title>
    <link href="http://example.com/2021/08/09/%E8%BF%90%E8%A1%8C%E6%97%B6%E5%8E%8B%E7%BC%A9/"/>
    <id>http://example.com/2021/08/09/%E8%BF%90%E8%A1%8C%E6%97%B6%E5%8E%8B%E7%BC%A9/</id>
    <published>2021-08-09T08:20:19.000Z</published>
    <updated>2021-08-09T08:30:13.504Z</updated>
    
    <content type="html"><![CDATA[<h1 id="一-数据压缩"><a href="#一-数据压缩" class="headerlink" title="一.数据压缩"></a>一.数据压缩</h1><p>对于数据压缩都比较熟悉，下面简单梳理一下相关知识。数据压缩(Data Compression )是计算机工程的主要研究内容，经过数十年发展已经有了深入研究，今后还会不断出现更多、更好的算法。如果日常生活中能够非常容易地压缩某个物体该多么方便啊!也就不再需要仓库、停车场、集装箱了，当然，得能压缩才行。而在数码世界,(只要不是压缩过的信息）任何信息都能轻松压缩。不论哪种形态的文件（数据）都是由二进制(0或1 )组成的，只要使用合适的压缩算法，就能缩减其大小。</p><p>经过压缩的文件若能100%恢复，则称该压缩为“无损压缩”(Lossless DataCompression );若不能恢复原状，则称该压缩为“有损压缩”( Loss Data Compression )。</p><h2 id="1-无损压缩"><a href="#1-无损压缩" class="headerlink" title="1.无损压缩"></a>1.无损压缩</h2><p>无损压缩用来缩减文件（数据)的大小，压缩后的文件更易保管、移动。使用经过压缩的文件之前，需要先对文件解压缩（此过程中应该保证数据完整性)。<br>各位肯定用过类似7-zip、“面包房”的压缩程序，用它们压缩文件就是无损压缩算法。最具代表性的无损压缩算法有Run-Length、Lempel-Ziv、Huffman等。此外还有许多其他压缩算法，它们都是在上面3种压缩算法的基础上改造而成的。只要准确理解了上面3种，就能轻松掌握其他各种压缩算法。ZIP、RAR等是具有代表性的压缩文件格式，它们最根本的压缩理念也是Run-Length、Lempel-Ziv、Huffman，然后应用了一些各自特有的技术（压缩率、压缩/解压时间)。</p><h2 id="2-有损压缩"><a href="#2-有损压缩" class="headerlink" title="2.有损压缩"></a>2.有损压缩</h2><p>相反，有损压缩允许压缩文件（数据)时损失一定信息，以此换取高压缩率。压缩多媒体文件(jpg、mp3 、mp4)时，大部分都使用这种有损压缩方式。从压缩特性来看，有损压缩的数据解压缩后不能完全恢复原始数据。人类的肉眼与听觉几乎无法察觉到这些多媒体文件在压缩中损失的数据。经过有损压缩后，虽然压缩文件与原文件(从数据层面上看)存在差异，但重要的是人们几乎区分不出这种微小的差别。以mp3文件为例，mp3的核心算法通过删除超越人类听觉范围(20~20000Hz）的波长区段来缩减（不需要的)数据大小。</p><h1 id="二-运行时压缩器"><a href="#二-运行时压缩器" class="headerlink" title="二.运行时压缩器"></a>二.运行时压缩器</h1><p>顾名思义，运行时压缩器是针对可执行(PE，Portable Executable)文件而言的，可执行文件内部含有解压缩代码，文件在运行瞬间于内存中解压缩后执行。运行时压缩文件也是PE文件，内部含有原PE文件与解码程序。在程序的EP代码中执行解码程序，同时在内存中解压缩后执行。</p><p>与普通压缩器相比，运行时压缩器的一个明显不同是“PE文件的可运行性”。把普通PE文件创建成运行时压缩文件的实用程序称为“压缩器”( Packer )，经反逆向( Anti-Reversing)技术特别处理的压缩器称为保护器(Protector )。</p><h2 id="1-压缩器"><a href="#1-压缩器" class="headerlink" title="1.压缩器"></a>1.压缩器</h2><p>PE压缩器是指可执行文件的压缩器，准确一点应该称为“运行时压缩器”，它是PE文件的专用压缩器。</p><h3 id="1-使用目的"><a href="#1-使用目的" class="headerlink" title="1.使用目的"></a>1.使用目的</h3><p>●缩减PE文件的大小<br>文件尺寸小是其突出的优点之一，更便于网络传输与保存。●隐藏PE文件内部代码与资源<br>使用压缩器的另一个原因在于，它可以隐藏PE文件内的代码及资源（字符串、API名称字符串)等。压缩后的数据以难以辨识的二进制文件保存，从文件本身来看，这能有效隐藏内部代码与资源（当然解压缩后可以通过内存的Dump窗口查看)。</p><h3 id="2-使用现状"><a href="#2-使用现状" class="headerlink" title="2.使用现状"></a>2.使用现状</h3><p>运行时压缩的概念早在DOS时代就出现了，可当时并未广泛使用。因为那时的PC速度不怎么快，每次执行文件时，解压缩的过程会引起很大的系统开销。而现在的PC速度已经变得非常快，用户不能明显察觉运行时压缩文件与源文件在执行时间上的差别。因此，现在的实用程序、“打补丁”文件、普通程序等都广泛应用运行时压缩。</p><h3 id="3-压缩器种类"><a href="#3-压缩器种类" class="headerlink" title="3.压缩器种类"></a>3.压缩器种类</h3><p>PE压缩器大致可分为两类:一类是单纯用于压缩普通PE文件的压缩器;另一类是对源文件进行较大变形、严重破坏PE头、意图稍嫌不纯的压缩器。这里说的“意图不纯的压缩器”是指专门用于恶意程序(如:Virtus、Trojan、Worm等)的压缩器。</p><p>目的纯粹的压缩器(未经VirusTotal诊断):UPX、ASPack等.<br>目的不纯的压缩器(经VirusTotal诊断):UPack、 PESpin、NSAnti等。</p><h1 id="三-保护器"><a href="#三-保护器" class="headerlink" title="三.保护器"></a>三.保护器</h1><p>PE保护器是一类保护PE文件免受代码逆向分析的实用程序。它们不像普通的压缩器一样仅对PE文件进行运行时压缩,而应用了多种防止代码逆向分析的技术(反调试、反模拟、代码混乱、多态代码、垃圾代码、调试器监视等)。这类保护器使压缩后的PE文件尺寸反而比源文件要大一些，调试起来非常难。<br>详细分析保护器需要丰富的逆向分析经验。当然，网络上提供了各种解除保护器的技巧，运气好的话，即便是新手也可能顺利找到源文件的OEP ( Original Entry Point，原始入口点)，但大多数情况没这么幸运。</p><h2 id="1-使用目的-1"><a href="#1-使用目的-1" class="headerlink" title="1.使用目的"></a>1.使用目的</h2><p>·防止破解<br>相信没人愿意自己编写的程序被非法破解并使用。此时使用保护器可有效保护PE文件。●保护代码与资源保护器不仅可以保护PE文件本身，还可在文件运行时保护进程内存，防止打开Dump窗口。因此，使用保护器可以比较安全地保护程序自身的代码与资源。</p><h2 id="2-使用现状-1"><a href="#2-使用现状-1" class="headerlink" title="2.使用现状"></a>2.使用现状</h2><p>这类保护器大量应用于对破解很敏感的安全程序。比如安装在线游戏时会自动安装安全保护程序，游戏安全保护程序就是为了防止游戏“破解工具”运行的。<br>恶意的游戏破解者总是想方设法破解游戏的安全保护程序，因为破解成功后他们可以利用“游戏内核”获取金钱回报。所以，安全保护程序为了防止恶意破解而使用各种保护器来保护自己（不断更换保护器会让游戏破解者们发疯)。<br>另一方面，常见的恶性代码(Trojan、Worm)中也大量使用保护器来防止(或降低)杀毒软件的检测。有些保护器还能提供“多变的代码”,每次都会生成不同形态（但功能相同)的代码,这给病毒诊断带来很大困难。</p><h2 id="3-保护器种类"><a href="#3-保护器种类" class="headerlink" title="3.保护器种类"></a>3.保护器种类</h2><p>保护器种类多样，有公用程序、商业程序,还有专门供恶意代码使用的保护器。</p><p>保护器分类<br>商用保护器:ASProtect. Themida、SVKP等。                                                                                                                 公用保护器:UltraProtect、Morphine等。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;一-数据压缩&quot;&gt;&lt;a href=&quot;#一-数据压缩&quot; class=&quot;headerlink&quot; title=&quot;一.数据压缩&quot;&gt;&lt;/a&gt;一.数据压缩&lt;/h1&gt;&lt;p&gt;对于数据压缩都比较熟悉，下面简单梳理一下相关知识。数据压缩(Data Compression )是计算机工程</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>BUUCTF--findKey</title>
    <link href="http://example.com/2021/08/08/BUUCTF-findKey/"/>
    <id>http://example.com/2021/08/08/BUUCTF-findKey/</id>
    <published>2021-08-08T06:39:58.000Z</published>
    <updated>2021-08-08T06:59:20.578Z</updated>
    
    <content type="html"><![CDATA[<h1 id="BUUCTF–findKey"><a href="#BUUCTF–findKey" class="headerlink" title="BUUCTF–findKey"></a>BUUCTF–findKey</h1><p>IDA打开，发现没有直接找到加密函数，通过字符串查找**flag{}**找到函数，发现没有转换成函数，选中区域，通过p键转换成函数。</p><p><img src="/2021/08/08/BUUCTF-findKey/1.PNG" alt="1"></p><p>将<strong>0kk<code>d1a</code>55k222k2a776jbfgd`06cjjb</strong>给了str，SS给了v13，sub_401005函数发现是一个异或，那就是str和v13异或，下面一个if判断String1和Str是否相等。回过头去找String1在哪里出现过，发现上面的sub_40101E对String1进行了加密</p><p><img src="/2021/08/08/BUUCTF-findKey/2.PNG" alt="2"></p><p>API CryptCreateHash，0x8003u可以知道是MD5</p><p>接下来unk_423030给v12，与原来的String1异或</p><p>第一个过程，使用0kk<code>d1a</code>55k222k2a776jbfgd`06cjjb和SS异或，得到c8837b23ff8aaa8a2dde915473ce0991，md5解密得到String1=123321</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"></span><br><span class="line">a = <span class="string">&quot;0kk`d1a`55k222k2a776jbfgd`06cjjb&quot;</span></span><br><span class="line">b = <span class="string">&quot;SS&quot;</span></span><br><span class="line">s = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(a)):</span><br><span class="line">    s += <span class="built_in">chr</span>(<span class="built_in">ord</span>(a[i]) ^ <span class="built_in">ord</span>(b[i % <span class="number">2</span>]))</span><br><span class="line"><span class="built_in">print</span> (s)</span><br><span class="line"></span><br><span class="line">c = [<span class="number">0x57</span>, <span class="number">0x5E</span>, <span class="number">0x52</span>, <span class="number">0x54</span>, <span class="number">0x49</span>, <span class="number">0x5F</span>, <span class="number">0x01</span>, <span class="number">0x6D</span>, <span class="number">0x69</span>, <span class="number">0x46</span>, <span class="number">0x02</span>, <span class="number">0x6E</span>, <span class="number">0x5F</span>, <span class="number">0x02</span>, <span class="number">0x6C</span>, <span class="number">0x57</span>, <span class="number">0x5B</span>, <span class="number">0x54</span>, <span class="number">0x4C</span>,</span><br><span class="line">     <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x53</span>, <span class="number">0x53</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x30</span>, <span class="number">0x6B</span>, <span class="number">0x6B</span>, <span class="number">0x60</span>, <span class="number">0x64</span>, <span class="number">0x31</span>, <span class="number">0x61</span>, <span class="number">0x60</span>, <span class="number">0x35</span>, <span class="number">0x35</span>,</span><br><span class="line">     <span class="number">0x6B</span>, <span class="number">0x32</span>, <span class="number">0x32</span>, <span class="number">0x32</span>, <span class="number">0x6B</span>, <span class="number">0x32</span>, <span class="number">0x61</span>, <span class="number">0x37</span>, <span class="number">0x37</span>, <span class="number">0x36</span>, <span class="number">0x6A</span>, <span class="number">0x62</span>]</span><br><span class="line">d = <span class="string">&#x27;123321&#x27;</span></span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>((<span class="built_in">len</span>(c))):</span><br><span class="line">    flag += <span class="built_in">chr</span>(c[i]^<span class="built_in">ord</span>(d[i % <span class="built_in">len</span>(d)]))</span><br><span class="line"><span class="built_in">print</span> (flag)</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;BUUCTF–findKey&quot;&gt;&lt;a href=&quot;#BUUCTF–findKey&quot; class=&quot;headerlink&quot; title=&quot;BUUCTF–findKey&quot;&gt;&lt;/a&gt;BUUCTF–findKey&lt;/h1&gt;&lt;p&gt;IDA打开，发现没有直接找到加密函数，通过字</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>IDC脚本</title>
    <link href="http://example.com/2021/08/05/idc/"/>
    <id>http://example.com/2021/08/05/idc/</id>
    <published>2021-08-05T07:29:44.000Z</published>
    <updated>2021-08-05T07:34:25.464Z</updated>
    
    <content type="html"><![CDATA[<h2 id="IDC的变量"><a href="#IDC的变量" class="headerlink" title="IDC的变量"></a>IDC的变量</h2><p>idc使用三种基本数据类型 整形，字符串，浮点值</p><p>idc使用auto关键字声明变量，使用extern关键字声</p><p>明全局变量</p><p>auto var = 1;          //局部变量</p><p>extern var2 = 1;      //全局变量</p><h2 id="IDC的运算符"><a href="#IDC的运算符" class="headerlink" title="IDC的运算符"></a>IDC的运算符</h2><p>idc支持绝大部分c的运算符，但是不支持如+=的复合运算符，并且idc所有整数操作数</p><p>均作为有符号处理，移位运算符如&gt;&gt;总是进行算术移位，想要完成逻辑移位，必须手</p><p>动进行位运算。字符串是idc的基本类型，所以可以执行+号运算符拼接字符串。<br>IDC语句</p><p>idc不支持switch语句其他语句风格与c一致，以分号结束语句。</p><h2 id="IDC函数"><a href="#IDC函数" class="headerlink" title="IDC函数"></a>IDC函数</h2><p>idc仅在idc的独立程序脚本中支持定义用户的函数。使用static关键字声明函数，可以使用return</p><p>返回一个值，return并非必须。参数为&amp;a表示传引用</p><p>static func(a,b,c){</p><p>//函数体</p><p>}</p><h2 id="IDC实用函数"><a href="#IDC实用函数" class="headerlink" title="IDC实用函数"></a>IDC实用函数</h2><p>1）void PatchByte(long addr , long val) 设置虚拟地址addr处的一个字节值，PatchByte可更换为PatchWord，PatchDword设置虚拟地址addr处的2字节和4字节值。</p><p>2）long Byte（long addr） 从虚拟地址addr读取一个字节值，Byte可更换为Word，Dword读取2字节和4字节值。</p><p>3）void Message（string format , …）,在输出窗口打印一条格式化消息。</p><p>4）void print（…），在输出窗口中打印每个参数的字符串表示形式。</p><p>5）long atol（string val），将10进制val转化成对应整数值。</p><p>6）long xtol（string val），将16进制val转化成对应整数值。</p><p>7）long ord（string ch），返回单字符字符串ch的ASCII值。</p><p>8）string Name（long addr），返回与给定地址有关的名称，如果该位置没有名称，则返回空字符串。</p><p> 在独立的.idc脚本文件编写脚本时，需要按如下结构</p><p>#include&lt;idc.idc&gt;</p><p>static main(){</p><p>//主函数</p><p>}</p><p>保存为.idc文件后，打开ida在菜单中File&gt;Script File可以执行idc脚本</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;IDC的变量&quot;&gt;&lt;a href=&quot;#IDC的变量&quot; class=&quot;headerlink&quot; title=&quot;IDC的变量&quot;&gt;&lt;/a&gt;IDC的变量&lt;/h2&gt;&lt;p&gt;idc使用三种基本数据类型 整形，字符串，浮点值&lt;/p&gt;
&lt;p&gt;idc使用auto关键字声明变量，使用ext</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>CPP</title>
    <link href="http://example.com/2021/08/05/CPP/"/>
    <id>http://example.com/2021/08/05/CPP/</id>
    <published>2021-08-05T02:40:07.000Z</published>
    <updated>2021-08-05T03:24:48.420Z</updated>
    
    <content type="html"><![CDATA[<h1 id="GXYCTF2019-simple-CPP"><a href="#GXYCTF2019-simple-CPP" class="headerlink" title="[GXYCTF2019]simple CPP"></a>[GXYCTF2019]simple CPP</h1><p>查壳，64位无壳,先打开看看</p><p><img src="/2021/08/05/CPP/1.PNG" alt="1"></p><p>IDA打开找到主函数</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">bool</span> v3; <span class="comment">// si</span></span><br><span class="line">  __int64 v4; <span class="comment">// rax</span></span><br><span class="line">  __int64 v5; <span class="comment">// r8</span></span><br><span class="line">  __int64 v6; <span class="comment">// r8</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int8 *v7; <span class="comment">// rax</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int8 *v8; <span class="comment">// rbx</span></span><br><span class="line">  <span class="keyword">int</span> v9; <span class="comment">// er10</span></span><br><span class="line">  __int64 v10; <span class="comment">// r11</span></span><br><span class="line">  <span class="keyword">void</span> **v11; <span class="comment">// r9</span></span><br><span class="line">  <span class="keyword">void</span> **v12; <span class="comment">// r8</span></span><br><span class="line">  __int64 v13; <span class="comment">// rdi</span></span><br><span class="line">  __int64 v14; <span class="comment">// r15</span></span><br><span class="line">  __int64 v15; <span class="comment">// r12</span></span><br><span class="line">  __int64 v16; <span class="comment">// rbp</span></span><br><span class="line">  <span class="keyword">int</span> v17; <span class="comment">// ecx</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int8 *v18; <span class="comment">// rdx</span></span><br><span class="line">  __int64 v19; <span class="comment">// rdi</span></span><br><span class="line">  __int64 *v20; <span class="comment">// r14</span></span><br><span class="line">  __int64 v21; <span class="comment">// rbp</span></span><br><span class="line">  __int64 v22; <span class="comment">// r13</span></span><br><span class="line">  __int64 *v23; <span class="comment">// rdi</span></span><br><span class="line">  __int64 v24; <span class="comment">// r8</span></span><br><span class="line">  __int64 v25; <span class="comment">// r12</span></span><br><span class="line">  __int64 v26; <span class="comment">// r15</span></span><br><span class="line">  __int64 v27; <span class="comment">// rbp</span></span><br><span class="line">  __int64 v28; <span class="comment">// rdx</span></span><br><span class="line">  __int64 v29; <span class="comment">// rbp</span></span><br><span class="line">  __int64 v30; <span class="comment">// rbp</span></span><br><span class="line">  __int64 v31; <span class="comment">// r10</span></span><br><span class="line">  __int64 v32; <span class="comment">// rdi</span></span><br><span class="line">  __int64 v33; <span class="comment">// r8</span></span><br><span class="line">  <span class="keyword">bool</span> v34; <span class="comment">// dl</span></span><br><span class="line">  __int64 v35; <span class="comment">// rax</span></span><br><span class="line">  <span class="keyword">void</span> **v36; <span class="comment">// rdx</span></span><br><span class="line">  __int64 v37; <span class="comment">// rax</span></span><br><span class="line">  __int64 v38; <span class="comment">// r8</span></span><br><span class="line">  __int64 v39; <span class="comment">// rax</span></span><br><span class="line">  <span class="keyword">void</span> *v40; <span class="comment">// rcx</span></span><br><span class="line">  __int64 v42; <span class="comment">// [rsp+20h] [rbp-68h]</span></span><br><span class="line">  <span class="keyword">void</span> *Block[<span class="number">2</span>]; <span class="comment">// [rsp+30h] [rbp-58h] BYREF</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v44; <span class="comment">// [rsp+40h] [rbp-48h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v45; <span class="comment">// [rsp+48h] [rbp-40h]</span></span><br><span class="line"></span><br><span class="line">  v3 = <span class="number">0</span>;</span><br><span class="line">  v44 = <span class="number">0</span>i64;</span><br><span class="line">  v45 = <span class="number">15</span>i64;</span><br><span class="line">  LOBYTE(Block[<span class="number">0</span>]) = <span class="number">0</span>;</span><br><span class="line">  v4 = sub_1400019C0(<span class="built_in">std</span>::<span class="built_in">cout</span>, <span class="string">&quot;I&#x27;m a first timer of Logic algebra , how about you?&quot;</span>, envp);</span><br><span class="line">  <span class="built_in">std</span>::ostream::<span class="keyword">operator</span>&lt;&lt;(v4, sub_140001B90);</span><br><span class="line">  sub_1400019C0(<span class="built_in">std</span>::<span class="built_in">cout</span>, <span class="string">&quot;Let&#x27;s start our game,Please input your flag:&quot;</span>, v5);</span><br><span class="line">  sub_140001DE0(<span class="built_in">std</span>::<span class="built_in">cin</span>, Block);</span><br><span class="line">  <span class="built_in">std</span>::ostream::<span class="keyword">operator</span>&lt;&lt;(<span class="built_in">std</span>::<span class="built_in">cout</span>, sub_140001B90);</span><br><span class="line">  <span class="keyword">if</span> ( v44 - <span class="number">5</span> &gt; <span class="number">0x19</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v39 = sub_1400019C0(<span class="built_in">std</span>::<span class="built_in">cout</span>, <span class="string">&quot;Wrong input ,no GXY&#123;&#125; in input words&quot;</span>, v6);</span><br><span class="line">    <span class="built_in">std</span>::ostream::<span class="keyword">operator</span>&lt;&lt;(v39, sub_140001B90);</span><br><span class="line">    <span class="keyword">goto</span> LABEL_43;</span><br><span class="line">  &#125;</span><br><span class="line">  v7 = (<span class="keyword">unsigned</span> __int8 *)<span class="keyword">operator</span> <span class="keyword">new</span>(<span class="number">0x20</span>ui64);</span><br><span class="line">  v8 = v7;</span><br><span class="line">  <span class="keyword">if</span> ( v7 )</span><br><span class="line">  &#123;</span><br><span class="line">    *(_QWORD *)v7 = <span class="number">0</span>i64;</span><br><span class="line">    *((_QWORD *)v7 + <span class="number">1</span>) = <span class="number">0</span>i64;</span><br><span class="line">    *((_QWORD *)v7 + <span class="number">2</span>) = <span class="number">0</span>i64;</span><br><span class="line">    *((_QWORD *)v7 + <span class="number">3</span>) = <span class="number">0</span>i64;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    v8 = <span class="number">0</span>i64;</span><br><span class="line">  &#125;</span><br><span class="line">  v9 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> ( v44 )</span><br><span class="line">  &#123;</span><br><span class="line">    v10 = <span class="number">0</span>i64;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      v11 = Block;</span><br><span class="line">      <span class="keyword">if</span> ( v45 &gt;= <span class="number">0x10</span> )</span><br><span class="line">        v11 = (<span class="keyword">void</span> **)Block[<span class="number">0</span>];</span><br><span class="line">      v12 = &amp;qword_140006048;</span><br><span class="line">      <span class="keyword">if</span> ( (<span class="keyword">unsigned</span> __int64)qword_140006060 &gt;= <span class="number">0x10</span> )</span><br><span class="line">        v12 = (<span class="keyword">void</span> **)qword_140006048;</span><br><span class="line">      v8[v10] = *((_BYTE *)v11 + v10) ^ *((_BYTE *)v12 + v9 % <span class="number">27</span>);</span><br><span class="line">      ++v9;</span><br><span class="line">      ++v10;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( v9 &lt; v44 );</span><br><span class="line">  &#125;</span><br><span class="line">  v13 = <span class="number">0</span>i64;</span><br><span class="line">  v14 = <span class="number">0</span>i64;</span><br><span class="line">  v15 = <span class="number">0</span>i64;</span><br><span class="line">  v16 = <span class="number">0</span>i64;</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="keyword">int</span>)v44 &gt; <span class="number">30</span> )</span><br><span class="line">    <span class="keyword">goto</span> LABEL_27;</span><br><span class="line">  v17 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="keyword">int</span>)v44 &lt;= <span class="number">0</span> )</span><br><span class="line">    <span class="keyword">goto</span> LABEL_27;</span><br><span class="line">  v18 = v8;</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">  &#123;</span><br><span class="line">    v19 = *v18 + v13;</span><br><span class="line">    ++v17;</span><br><span class="line">    ++v18;</span><br><span class="line">    <span class="keyword">switch</span> ( v17 )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">8</span>:</span><br><span class="line">        v16 = v19;</span><br><span class="line">        <span class="keyword">goto</span> LABEL_23;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">16</span>:</span><br><span class="line">        v15 = v19;</span><br><span class="line">        <span class="keyword">goto</span> LABEL_23;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">24</span>:</span><br><span class="line">        v14 = v19;</span><br><span class="line">LABEL_23:</span><br><span class="line">        v19 = <span class="number">0</span>i64;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">32</span>:</span><br><span class="line">        sub_1400019C0(<span class="built_in">std</span>::<span class="built_in">cout</span>, <span class="string">&quot;ERRO,out of range&quot;</span>, (<span class="keyword">unsigned</span> <span class="keyword">int</span>)v44);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    v13 = v19 &lt;&lt; <span class="number">8</span>;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br></pre></td></tr></table></figure><p>sub_1400019C0输出字符串，看到sub_140001DE0有一个Block，猜测输入的flag在Block里面，下面把block给了V11，qword_140006048给了V12，进行异或加密，查看qword_140006048找不到数据，利用动态调试寻找。</p><p><img src="/2021/08/05/CPP/11.PNG" alt="11"></p><p>qword_140006048的值为i_will_check_is_debug_or_not，也可以通过交叉引用找到给qword_140006048赋值的地方</p><p><img src="/2021/08/05/CPP/2.PNG" alt="2"></p><p>接下来判断长度&gt;30 或&lt;0，V18等于V8，V8就是上面经过异或的数据，一个个赋值。然后判断累加到8，16，24的时候将值给V16，V15，V14,到32则报错。v13 = v19 &lt;&lt; 8。没错位移一个字节用于堆叠，最后没满8位将数据保存在V13.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">while</span> ( v17 &lt; (<span class="keyword">int</span>)v44 );</span><br><span class="line">  <span class="keyword">if</span> ( v16 )</span><br><span class="line">  &#123;</span><br><span class="line">    v20 = (__int64 *)<span class="keyword">operator</span> <span class="keyword">new</span>(<span class="number">0x20</span>ui64);</span><br><span class="line">    *v20 = v16;</span><br><span class="line">    v20[<span class="number">1</span>] = v15;</span><br><span class="line">    v20[<span class="number">2</span>] = v14;</span><br><span class="line">    v20[<span class="number">3</span>] = v13;</span><br><span class="line">    <span class="keyword">goto</span> LABEL_28;</span><br><span class="line">  &#125;</span><br><span class="line">LABEL_27:</span><br><span class="line">  v20 = <span class="number">0</span>i64;</span><br><span class="line">LABEL_28:</span><br><span class="line">  v42 = v20[<span class="number">2</span>];</span><br><span class="line">  v21 = v20[<span class="number">1</span>];</span><br><span class="line">  v22 = *v20;</span><br><span class="line">  v23 = (__int64 *)<span class="keyword">operator</span> <span class="keyword">new</span>(<span class="number">0x20</span>ui64);</span><br><span class="line">  <span class="keyword">if</span> ( IsDebuggerPresent() )</span><br><span class="line">  &#123;</span><br><span class="line">    sub_1400019C0(<span class="built_in">std</span>::<span class="built_in">cout</span>, <span class="string">&quot;Hi , DO not debug me !&quot;</span>, v24);</span><br><span class="line">    Sleep(<span class="number">0x7D0</span>u);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  v25 = v21 &amp; v22;</span><br><span class="line">  *v23 = v21 &amp; v22;</span><br><span class="line">  v26 = v42 &amp; ~v22;</span><br><span class="line">  v23[<span class="number">1</span>] = v26;</span><br><span class="line">  v27 = ~v21;</span><br><span class="line">  v28 = v42 &amp; v27;</span><br><span class="line">  v23[<span class="number">2</span>] = v42 &amp; v27;</span><br><span class="line">  v29 = v22 &amp; v27;</span><br><span class="line">  v23[<span class="number">3</span>] = v29;</span><br><span class="line">  <span class="keyword">if</span> ( v26 != <span class="number">0x11204161012</span>i64 )</span><br><span class="line">  &#123;</span><br><span class="line">    v23[<span class="number">1</span>] = <span class="number">0</span>i64;</span><br><span class="line">    v26 = <span class="number">0</span>i64;</span><br><span class="line">  &#125;</span><br><span class="line">  v30 = v26 | v25 | v28 | v29;</span><br><span class="line">  v31 = v20[<span class="number">1</span>];</span><br><span class="line">  v32 = v20[<span class="number">2</span>];</span><br><span class="line">  v33 = v28 &amp; *v20 | v32 &amp; (v25 | v31 &amp; ~*v20 | ~(v31 | *v20));</span><br><span class="line">  v34 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> ( v33 == <span class="number">0x8020717153E3013</span>i64 )</span><br><span class="line">    v34 = v30 == <span class="number">0x3E3A4717373E7F1F</span>i64;</span><br><span class="line">  <span class="keyword">if</span> ( (v30 ^ v20[<span class="number">3</span>]) == <span class="number">0x3E3A4717050F791F</span>i64 )</span><br><span class="line">    v3 = v34;</span><br><span class="line">  <span class="keyword">if</span> ( (v26 | v25 | v31 &amp; v32) == (~*v20 &amp; v32 | <span class="number">0xC00020130082C0C</span>i64) &amp;&amp; v3 )</span><br><span class="line">  &#123;</span><br><span class="line">    v35 = sub_1400019C0(<span class="built_in">std</span>::<span class="built_in">cout</span>, <span class="string">&quot;Congratulations!flag is GXY&#123;&quot;</span>, v33);</span><br><span class="line">    v36 = Block;</span><br><span class="line">    <span class="keyword">if</span> ( v45 &gt;= <span class="number">0x10</span> )</span><br><span class="line">      v36 = (<span class="keyword">void</span> **)Block[<span class="number">0</span>];</span><br><span class="line">    v37 = sub_140001FD0(v35, v36, v44);</span><br><span class="line">    sub_1400019C0(v37, <span class="string">&quot;&#125;&quot;</span>, v38);</span><br><span class="line">    j_j_free(v8);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    sub_1400019C0(<span class="built_in">std</span>::<span class="built_in">cout</span>, <span class="string">&quot;Wrong answer!try again&quot;</span>, v33);</span><br><span class="line">    j_j_free(v8);</span><br><span class="line">  &#125;</span><br><span class="line">LABEL_43:</span><br><span class="line">  <span class="keyword">if</span> ( v45 &gt;= <span class="number">0x10</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v40 = Block[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">if</span> ( v45 + <span class="number">1</span> &gt;= <span class="number">0x1000</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v40 = (<span class="keyword">void</span> *)*((_QWORD *)Block[<span class="number">0</span>] - <span class="number">1</span>);</span><br><span class="line">      <span class="keyword">if</span> ( (<span class="keyword">unsigned</span> __int64)(Block[<span class="number">0</span>] - v40 - <span class="number">8</span>) &gt; <span class="number">0x1F</span> )</span><br><span class="line">        invalid_parameter_noinfo_noreturn();</span><br><span class="line">    &#125;</span><br><span class="line">    j_j_free(v40);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>接下来的一个if就是堆叠，后面的就是数据运算。</p><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">v42 = v20[2];</span><br><span class="line">v21 = v20[1];</span><br><span class="line">v22 = v20[0];</span><br><span class="line"></span><br><span class="line">v25 = v21 &amp; v22</span><br><span class="line">v23[0] = v21 &amp; v22</span><br><span class="line">得到v25=v23[0]= v21 &amp; v22=v20[1]&amp;v20[0]</span><br><span class="line"></span><br><span class="line">v26 = v42 &amp; ~v22</span><br><span class="line">v23[1] = v26;</span><br><span class="line">得到 v26 =v23[1]= v42 &amp; ~v22=v20[2]&amp;~v20[0]</span><br><span class="line"></span><br><span class="line">v27 = ~v21;</span><br><span class="line">得到 v27 = ~v21=~v20[1]</span><br><span class="line"></span><br><span class="line">v28 = v42 &amp; v27;</span><br><span class="line">v23[2] = v42 &amp; v27;</span><br><span class="line">得到 v23[2] = v42 &amp; v27=v28=v20[2]&amp; ~v20[1]</span><br><span class="line"></span><br><span class="line">v29 = v22 &amp; v27;</span><br><span class="line">v23[3] = v29;</span><br><span class="line">得到v29 = v22 &amp; v27=v23[3]=v20[0]&amp;~v20[1]</span><br><span class="line"></span><br><span class="line">v26=v23[1]=1176889593874</span><br><span class="line">得到 v20[2]&amp;~v20[0]=1176889593874</span><br><span class="line"></span><br><span class="line">v30 = v26 | v25 | v28 | v29</span><br><span class="line">得到 v27 =(v20[1]&amp;v20[0]) | (v20[1]&amp;v20[0]) |(v20[2]&amp; ~v20[1]) | (v20[0]&amp;~v20[1])=4483974544037412639</span><br><span class="line"></span><br><span class="line">v31 = v20[1];</span><br><span class="line">v32 = v20[2];</span><br><span class="line">v33 = v25 &amp; *v20 | v29 &amp; (v22 | v28 &amp; ~*v20 | ~(v28 | *v20))=577031497978884115i64</span><br><span class="line">得到v33 =（v20[2]&amp; ~v20[1]） &amp; v20[0] | v20[2] &amp; (（v20[1]&amp;v20[0]） | v20[1] &amp; ~v20[0] | ~(v20[1] | v20[0]))=577031497978884115</span><br><span class="line"></span><br><span class="line">v34 = v30 == 4483974544037412639i64;</span><br><span class="line">v30 ^ v20[3] == 4483974543195470111i64 )</span><br><span class="line">得到 v20[3]^(v20[1]&amp;v20[0]) | (v20[1]&amp;v20[0]) |(v20[2]&amp; ~v20[1]) | (v20[0]&amp;~v20[1])=4483974544037412639</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>x,y,z,w分别代表v20[0]~v20[3],用z3库求解</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">x,y,z,w=BitVecs(<span class="string">&#x27;x y z w&#x27;</span>,<span class="number">64</span>)</span><br><span class="line"></span><br><span class="line">s=Solver()</span><br><span class="line"></span><br><span class="line">s.add((~x)&amp;z==<span class="number">1176889593874</span>)</span><br><span class="line">s.add(((z&amp;~x)|(x&amp;y)|(z&amp;(~y))|(x&amp;(~y)))^w==<span class="number">4483974543195470111</span>)</span><br><span class="line">s.add(((z&amp;~y)&amp;x|z&amp;((x&amp;y)|y&amp;~x|~(y|x)))==<span class="number">577031497978884115</span>)</span><br><span class="line">s.add(((z&amp;~x)|(x&amp;y)|(z&amp;~y)|(x&amp;~y))==<span class="number">4483974544037412639</span>)</span><br><span class="line">s.add(((z&amp;(~x)) | (x&amp;y) | y &amp; z) == (((~x)&amp; z)|<span class="number">864693332579200012</span>))</span><br><span class="line"></span><br><span class="line">s.check()</span><br><span class="line">m = s.model()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> m:</span><br><span class="line">    print(<span class="string">&quot;%s = 0x%x&quot;</span>%(i,m[i].as_long()))</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>最后异或一下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Dst = <span class="string">&#x27;i_will_check_is_debug_or_noi_wil&#x27;</span></span><br><span class="line">flag=[<span class="number">0x3E</span>,<span class="number">0x3A</span>,<span class="number">0x46</span>,<span class="number">0x05</span>,<span class="number">0x33</span>,<span class="number">0x28</span>,<span class="number">0x6F</span>,<span class="number">0x0D</span>,<span class="number">0x8C</span>,<span class="number">0x00</span>,<span class="number">0x8A</span>,<span class="number">0x09</span>,<span class="number">0x78</span>,<span class="number">0x49</span>,<span class="number">0x2C</span>,<span class="number">0xAC</span>,<span class="number">0x08</span>,<span class="number">0x02</span>,<span class="number">0x07</span>,<span class="number">0x17</span>,<span class="number">0x15</span>,<span class="number">0x3E</span>,<span class="number">0x30</span>,<span class="number">0x13</span>,<span class="number">0x32</span>,<span class="number">0x31</span>,<span class="number">0x06</span>]</span><br><span class="line">s=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(flag)):</span><br><span class="line">    s+=<span class="built_in">chr</span>(<span class="built_in">ord</span>(Dst[i]) ^ flag[i])</span><br><span class="line">print(s)</span><br></pre></td></tr></table></figure><p>We1l_D0näeéb’ _ólgebra_am_i，有点奇怪，因为方程不止一个解</p><p>从We1l_D0n后开始把äeéb’ _ó改成e!P0or_a即是最后的flag</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;GXYCTF2019-simple-CPP&quot;&gt;&lt;a href=&quot;#GXYCTF2019-simple-CPP&quot; class=&quot;headerlink&quot; title=&quot;[GXYCTF2019]simple CPP&quot;&gt;&lt;/a&gt;[GXYCTF2019]simple CPP</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>2021巅峰极客reverse</title>
    <link href="http://example.com/2021/08/02/2021%E5%B7%85%E5%B3%B0%E6%9E%81%E5%AE%A2reverse/"/>
    <id>http://example.com/2021/08/02/2021%E5%B7%85%E5%B3%B0%E6%9E%81%E5%AE%A2reverse/</id>
    <published>2021-08-02T09:42:29.000Z</published>
    <updated>2021-08-03T06:30:14.568Z</updated>
    
    <content type="html"><![CDATA[<h1 id="baby-maze"><a href="#baby-maze" class="headerlink" title="baby_maze"></a>baby_maze</h1><p>看题目本来以为是一道简单的迷宫题，进去之后才发现这么多函数</p><p>先找一下string，发现了一个God job这应该就是最后的结果</p><p><img src="/2021/08/02/2021%E5%B7%85%E5%B3%B0%E6%9E%81%E5%AE%A2reverse/3.PNG" alt="3"></p><p>那可以想到通过这个函数去查看调用它的函数，一步步逆推回去，都是发现是行不通的，函数太多了有7000多个，没有办法找回去，做的时候前后都走不通</p><p><img src="/2021/08/02/2021%E5%B7%85%E5%B3%B0%E6%9E%81%E5%AE%A2reverse/5.PNG" alt="5"></p><p>后来才知道可以用后向调用为<code>gen_r_call_chain</code>函数，它递归地调用了<code>get_my_caller</code>函数来实现后向调用的追踪.接下来就可以在下面的交互终端run我们的函数：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gen_r_call_chain(<span class="string">&#x27;sub_54DE35&#x27;</span>, <span class="number">600</span>, <span class="string">&#x27;sub_40187C&#x27;</span>)</span><br></pre></td></tr></table></figure><p><img src="/2021/08/02/2021%E5%B7%85%E5%B3%B0%E6%9E%81%E5%AE%A2reverse/1.PNG" alt="1"></p><p>可以的到几个路径，看第一个符合，再加上第一个函数的S就是最后的结果</p><p>MD5一下就可以得到最后的flag</p><p><img src="/2021/08/02/2021%E5%B7%85%E5%B3%B0%E6%9E%81%E5%AE%A2reverse/6.PNG" alt="6"></p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;078c8fbc1d0d033f663dcc58e899c101&#125;</span><br></pre></td></tr></table></figure><h2 id="MedicalApp"><a href="#MedicalApp" class="headerlink" title="MedicalApp"></a>MedicalApp</h2><p>题目给了一个安卓APK，APK的主要逻辑都在native里面。</p><p>再chk函数里面就是加密过程，用到了RC4+xxtea</p><p><img src="/2021/08/02/2021%E5%B7%85%E5%B3%B0%E6%9E%81%E5%AE%A2reverse/7.PNG" alt="7"></p><p>找到密钥</p><p><img src="/2021/08/02/2021%E5%B7%85%E5%B3%B0%E6%9E%81%E5%AE%A2reverse/8.PNG" alt="8"></p><p>xxtea的解密</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt; </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> DELTA 0x9f5776b6  </span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MX (((z&gt;&gt;5^y<span class="meta-string">&lt;&lt;2) + (y&gt;&gt;3^z&lt;&lt;4)) ^ ((sum^y) + (key[(p&amp;3)^e] ^ z)))  </span></span></span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">btea</span><span class="params">(<span class="keyword">uint32_t</span> *v, <span class="keyword">int</span> n, <span class="keyword">uint32_t</span> <span class="keyword">const</span> key[<span class="number">4</span>])</span>  </span></span><br><span class="line"><span class="function"></span>&#123;  </span><br><span class="line">    <span class="keyword">uint32_t</span> y, z, sum;  </span><br><span class="line">    <span class="keyword">unsigned</span> p, rounds, e;  </span><br><span class="line">    <span class="keyword">if</span> (n &gt; <span class="number">1</span>)            <span class="comment">/* Coding Part */</span>  </span><br><span class="line">    &#123;  </span><br><span class="line">        rounds = <span class="number">6</span> + <span class="number">52</span>/n;  </span><br><span class="line">        sum = <span class="number">0</span>;  </span><br><span class="line">        z = v[n<span class="number">-1</span>];  </span><br><span class="line">        <span class="keyword">do</span>  </span><br><span class="line">        &#123;  </span><br><span class="line">            sum += DELTA;  </span><br><span class="line">            e = (sum &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span>;  </span><br><span class="line">            <span class="keyword">for</span> (p=<span class="number">0</span>; p&lt;n<span class="number">-1</span>; p++)  </span><br><span class="line">            &#123;  </span><br><span class="line">                y = v[p+<span class="number">1</span>];  </span><br><span class="line">                z = v[p] += MX;  </span><br><span class="line">            &#125;  </span><br><span class="line">            y = v[<span class="number">0</span>];  </span><br><span class="line">            z = v[n<span class="number">-1</span>] += MX;  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">while</span> (--rounds);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (n &lt; <span class="number">-1</span>)      <span class="comment">/* Decoding Part */</span>  </span><br><span class="line">    &#123;  </span><br><span class="line">        n = -n;  </span><br><span class="line">        rounds = <span class="number">6</span> + <span class="number">52</span>/n;  </span><br><span class="line">        sum = rounds*DELTA;  </span><br><span class="line">        y = v[<span class="number">0</span>];  </span><br><span class="line">        <span class="keyword">do</span>  </span><br><span class="line">        &#123;  </span><br><span class="line">            e = (sum &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span>;  </span><br><span class="line">            <span class="keyword">for</span> (p=n<span class="number">-1</span>; p&gt;<span class="number">0</span>; p--)  </span><br><span class="line">            &#123;  </span><br><span class="line">                z = v[p<span class="number">-1</span>];  </span><br><span class="line">                y = v[p] -= MX;  </span><br><span class="line">            &#125;  </span><br><span class="line">            z = v[n<span class="number">-1</span>];  </span><br><span class="line">            y = v[<span class="number">0</span>] -= MX;  </span><br><span class="line">            sum -= DELTA;  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">while</span> (--rounds);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span>  </span></span><br><span class="line"><span class="function"></span>&#123;  </span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> d[] =</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x10</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, </span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x10</span>, <span class="number">0x00</span>, <span class="number">0x00</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> ida_chars[] =</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="number">0x3E</span>, <span class="number">0x97</span>, <span class="number">0xE5</span>, <span class="number">0x68</span>, <span class="number">0x67</span>, <span class="number">0x73</span>, <span class="number">0x0C</span>, <span class="number">0xC2</span>, <span class="number">0x1B</span>, <span class="number">0xD4</span>, </span><br><span class="line">    <span class="number">0xAF</span>, <span class="number">0x98</span>, <span class="number">0xE2</span>, <span class="number">0x9D</span>, <span class="number">0x4B</span>, <span class="number">0xFE</span>, <span class="number">0x0B</span>, <span class="number">0xB6</span>, <span class="number">0xA5</span>, <span class="number">0x01</span>, </span><br><span class="line">    <span class="number">0x46</span>, <span class="number">0xD6</span>, <span class="number">0x36</span>, <span class="number">0x3D</span>, <span class="number">0xAF</span>, <span class="number">0x7B</span>, <span class="number">0xCC</span>, <span class="number">0xDB</span>, <span class="number">0x00</span>, <span class="number">0x4F</span>, </span><br><span class="line">    <span class="number">0x41</span>, <span class="number">0xA0</span>, <span class="number">0x1A</span>, <span class="number">0xE7</span>, <span class="number">0x2C</span>, <span class="number">0x76</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">uint32_t</span> key[<span class="number">4</span>];</span><br><span class="line">    <span class="keyword">uint32_t</span> cipher[<span class="number">9</span>];</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;AOLIGEI111&quot;</span>);</span><br><span class="line">    <span class="built_in">memcpy</span>(key, d, <span class="keyword">sizeof</span>(d));</span><br><span class="line">    <span class="built_in">memcpy</span>(cipher, ida_chars, <span class="keyword">sizeof</span>(ida_chars));</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;AOLIGEI222&quot;</span>); </span><br><span class="line">    <span class="keyword">int</span> n= <span class="number">9</span>;</span><br><span class="line">    btea(cipher, -n, key);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">36</span>; i++) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%02x&quot;</span>, *((<span class="keyword">unsigned</span> <span class="keyword">char</span>*)cipher + i));</span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>RC4</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rc4_crypt</span>(<span class="params">PlainBytes:<span class="built_in">bytes</span>, KeyBytes:<span class="built_in">bytes</span></span>) -&gt; str:</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;[summary]</span></span><br><span class="line"><span class="string">    rc4 crypt</span></span><br><span class="line"><span class="string">    Arguments:</span></span><br><span class="line"><span class="string">        PlainBytes &#123;[bytes]&#125; -- [plain bytes]</span></span><br><span class="line"><span class="string">        KeyBytes &#123;[bytes]&#125; -- [key bytes]</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    Returns:</span></span><br><span class="line"><span class="string">        [string] -- [hex string]</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line"> </span><br><span class="line">    keystreamList = []</span><br><span class="line">    cipherList = []</span><br><span class="line"> </span><br><span class="line">    keyLen = <span class="built_in">len</span>(KeyBytes)</span><br><span class="line">    plainLen = <span class="built_in">len</span>(PlainBytes)</span><br><span class="line">    S = <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">256</span>))</span><br><span class="line"> </span><br><span class="line">    j = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">        j = (j + S[i] + KeyBytes[i % keyLen]) % <span class="number">256</span></span><br><span class="line">        S[i], S[j] = S[j], S[i]</span><br><span class="line"> </span><br><span class="line">    print(<span class="built_in">bytes</span>(S).<span class="built_in">hex</span>())</span><br><span class="line"></span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    j = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> m <span class="keyword">in</span> <span class="built_in">range</span>(plainLen):</span><br><span class="line">        i = (i + <span class="number">1</span>) % <span class="number">256</span></span><br><span class="line">        j = (j + S[i]) % <span class="number">256</span></span><br><span class="line">        print(i, j)</span><br><span class="line">        S[i], S[j] = S[j], S[i]</span><br><span class="line">        k = S[(S[i] + S[j]) % <span class="number">256</span>]</span><br><span class="line">        print(S[i], S[j])</span><br><span class="line">        cipherList.append(k ^ PlainBytes[m])</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>(cipherList)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    data = <span class="string">&#x27;5604b0d49c634d3096cec00593be3b82524b16b28a33b74d6d7b9950c2b10c12e1840a93&#x27;</span></span><br><span class="line">    key = <span class="string">&#x27;01000000100000000001000000100000&#x27;</span></span><br><span class="line">    data = <span class="built_in">bytes</span>.fromhex(data)</span><br><span class="line">    key = <span class="built_in">bytes</span>.fromhex(key)</span><br><span class="line">    m = rc4_crypt(data, key)</span><br><span class="line">    print(m)</span><br></pre></td></tr></table></figure><p>RC4解密结果为：</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;194836950ae9df840e8a94348b901a&#125;</span><br></pre></td></tr></table></figure><h3 id="xxtea"><a href="#xxtea" class="headerlink" title="xxtea"></a>xxtea</h3><p>XXTEA，又称Corrected Block TEA，是XTEA的升级版</p><p>，设计者是Roger Needham, David Wheeler</p><p>加密过程：</p><p><img src="https://upload-images.jianshu.io/upload_images/1272254-9fcbbcba52c083a9?imageMogr2/auto-orient/strip%7CimageView2/2/w/391/format/webp" alt="img"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;baby-maze&quot;&gt;&lt;a href=&quot;#baby-maze&quot; class=&quot;headerlink&quot; title=&quot;baby_maze&quot;&gt;&lt;/a&gt;baby_maze&lt;/h1&gt;&lt;p&gt;看题目本来以为是一道简单的迷宫题，进去之后才发现这么多函数&lt;/p&gt;
&lt;p&gt;先找一下s</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>BUU-reverse3</title>
    <link href="http://example.com/2021/08/01/BUU-reverse3/"/>
    <id>http://example.com/2021/08/01/BUU-reverse3/</id>
    <published>2021-08-01T02:26:16.000Z</published>
    <updated>2021-08-01T02:49:37.297Z</updated>
    
    <content type="html"><![CDATA[<h1 id="BJDCTF2020-BJD-hamburger-competition"><a href="#BJDCTF2020-BJD-hamburger-competition" class="headerlink" title="[BJDCTF2020]BJD hamburger competition]"></a>[BJDCTF2020]BJD hamburger competition]</h1><p><strong>识别Unity游戏</strong></p><p>Android平台的apk包可以直接解压，看是否有./assets/bin/Data/Managed目录，也可以查看lib文件夹下面包含的一些so，如果有libmono,libunity等模块，基本可以确定是unity游戏了。</p><p>Android平台中C#编写的主逻辑模块代码静态编辑之后存储于Assembly-CSharp.dll文件中。因为unity的跨平台，Android平台是unity编译的游戏，那么其对应的IOS平台上也是unity编译出来的。如果希望直接从IOS上面去看是否是unity游戏，可以提取游戏中的主模块查看是否有unity之类的函数即可。</p><p>这道题找对文件分析就行，dnSpy打开Assembly-CSharp.dll文件</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line">  <span class="number">1</span> <span class="keyword">using</span> System;</span><br><span class="line">  <span class="number">2</span> <span class="keyword">using</span> System.Security.Cryptography;</span><br><span class="line">  <span class="number">3</span> <span class="keyword">using</span> System.Text;</span><br><span class="line">  <span class="number">4</span> <span class="keyword">using</span> UnityEngine;</span><br><span class="line">  <span class="number">5</span> </span><br><span class="line">  <span class="number">6</span> <span class="comment">// Token: 0x02000004 RID: 4</span></span><br><span class="line">  <span class="number">7</span> <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ButtonSpawnFruit</span> :</span> MonoBehaviour</span><br><span class="line">  <span class="number">8</span> &#123;</span><br><span class="line">  <span class="number">9</span>     <span class="comment">// Token: 0x0600000A RID: 10 RVA: 0x00002110 File Offset: 0x00000310</span></span><br><span class="line"> <span class="number">10</span>     <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">string</span> <span class="title">Md5</span><span class="params">(<span class="built_in">string</span> str)</span></span></span><br><span class="line"><span class="function"> 11     </span>&#123;</span><br><span class="line"> <span class="number">12</span>         byte[] bytes = Encoding.UTF8.GetBytes(str);</span><br><span class="line"> <span class="number">13</span>         byte[] <span class="built_in">array</span> = MD5.Create().ComputeHash(bytes);</span><br><span class="line"> <span class="number">14</span>         StringBuilder stringBuilder = <span class="keyword">new</span> StringBuilder();</span><br><span class="line"> <span class="number">15</span>         foreach (byte b in <span class="built_in">array</span>)</span><br><span class="line"> <span class="number">16</span>         &#123;</span><br><span class="line"> <span class="number">17</span>             stringBuilder.Append(b.ToString(<span class="string">&quot;X2&quot;</span>));</span><br><span class="line"> <span class="number">18</span>         &#125;</span><br><span class="line"> <span class="number">19</span>         <span class="keyword">return</span> stringBuilder.ToString().Substring(<span class="number">0</span>, <span class="number">20</span>);</span><br><span class="line"> <span class="number">20</span>     &#125;</span><br><span class="line"> <span class="number">21</span> </span><br><span class="line"> <span class="number">22</span>     <span class="comment">// Token: 0x0600000B RID: 11 RVA: 0x00002170 File Offset: 0x00000370</span></span><br><span class="line"> <span class="number">23</span>     <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">string</span> <span class="title">Sha1</span><span class="params">(<span class="built_in">string</span> str)</span></span></span><br><span class="line"><span class="function"> 24     </span>&#123;</span><br><span class="line"> <span class="number">25</span>         byte[] bytes = Encoding.UTF8.GetBytes(str);</span><br><span class="line"> <span class="number">26</span>         byte[] <span class="built_in">array</span> = SHA1.Create().ComputeHash(bytes);</span><br><span class="line"> <span class="number">27</span>         StringBuilder stringBuilder = <span class="keyword">new</span> StringBuilder();</span><br><span class="line"> <span class="number">28</span>         foreach (byte b in <span class="built_in">array</span>)</span><br><span class="line"> <span class="number">29</span>         &#123;</span><br><span class="line"> <span class="number">30</span>             stringBuilder.Append(b.ToString(<span class="string">&quot;X2&quot;</span>));</span><br><span class="line"> <span class="number">31</span>         &#125;</span><br><span class="line"> <span class="number">32</span>         <span class="keyword">return</span> stringBuilder.ToString();</span><br><span class="line"> <span class="number">33</span>     &#125;</span><br><span class="line"> <span class="number">34</span> </span><br><span class="line"> <span class="number">35</span>     <span class="comment">// Token: 0x0600000C RID: 12 RVA: 0x000021C8 File Offset: 0x000003C8</span></span><br><span class="line"> <span class="number">36</span>     <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Spawn</span><span class="params">()</span></span></span><br><span class="line"><span class="function"> 37     </span>&#123;</span><br><span class="line"> <span class="number">38</span>         FruitSpawner component = GameObject.FindWithTag(<span class="string">&quot;GameController&quot;</span>).GetComponent&lt;FruitSpawner&gt;();</span><br><span class="line"> <span class="number">39</span>         <span class="keyword">if</span> (component)</span><br><span class="line"> <span class="number">40</span>         &#123;</span><br><span class="line"> <span class="number">41</span>             <span class="keyword">if</span> (<span class="keyword">this</span>.audioSources.Length != <span class="number">0</span>)</span><br><span class="line"> <span class="number">42</span>             &#123;</span><br><span class="line"> <span class="number">43</span>                 <span class="keyword">this</span>.audioSources[Random.Range(<span class="number">0</span>, <span class="keyword">this</span>.audioSources.Length)].Play();</span><br><span class="line"> <span class="number">44</span>             &#125;</span><br><span class="line"> <span class="number">45</span>             component.Spawn(<span class="keyword">this</span>.toSpawn);</span><br><span class="line"> <span class="number">46</span>             <span class="built_in">string</span> name = <span class="keyword">this</span>.toSpawn.name;</span><br><span class="line"> <span class="number">47</span>             <span class="keyword">if</span> (name == <span class="string">&quot;汉堡底&quot;</span> &amp;&amp; Init.spawnCount == <span class="number">0</span>)</span><br><span class="line"> <span class="number">48</span>             &#123;</span><br><span class="line"> <span class="number">49</span>                 Init.secret += <span class="number">997</span>;</span><br><span class="line"> <span class="number">50</span>             &#125;</span><br><span class="line"> <span class="number">51</span>             <span class="keyword">else</span> <span class="keyword">if</span> (name == <span class="string">&quot;鸭屁股&quot;</span>)</span><br><span class="line"> <span class="number">52</span>             &#123;</span><br><span class="line"> <span class="number">53</span>                 Init.secret -= <span class="number">127</span>;</span><br><span class="line"> <span class="number">54</span>             &#125;</span><br><span class="line"> <span class="number">55</span>             <span class="keyword">else</span> <span class="keyword">if</span> (name == <span class="string">&quot;胡罗贝&quot;</span>)</span><br><span class="line"> <span class="number">56</span>             &#123;</span><br><span class="line"> <span class="number">57</span>                 Init.secret *= <span class="number">3</span>;</span><br><span class="line"> <span class="number">58</span>             &#125;</span><br><span class="line"> <span class="number">59</span>             <span class="keyword">else</span> <span class="keyword">if</span> (name == <span class="string">&quot;臭豆腐&quot;</span>)</span><br><span class="line"> <span class="number">60</span>             &#123;</span><br><span class="line"> <span class="number">61</span>                 Init.secret ^= <span class="number">18</span>;</span><br><span class="line"> <span class="number">62</span>             &#125;</span><br><span class="line"> <span class="number">63</span>             <span class="keyword">else</span> <span class="keyword">if</span> (name == <span class="string">&quot;俘虏&quot;</span>)</span><br><span class="line"> <span class="number">64</span>             &#123;</span><br><span class="line"> <span class="number">65</span>                 Init.secret += <span class="number">29</span>;</span><br><span class="line"> <span class="number">66</span>             &#125;</span><br><span class="line"> <span class="number">67</span>             <span class="keyword">else</span> <span class="keyword">if</span> (name == <span class="string">&quot;白拆&quot;</span>)</span><br><span class="line"> <span class="number">68</span>             &#123;</span><br><span class="line"> <span class="number">69</span>                 Init.secret -= <span class="number">47</span>;</span><br><span class="line"> <span class="number">70</span>             &#125;</span><br><span class="line"> <span class="number">71</span>             <span class="keyword">else</span> <span class="keyword">if</span> (name == <span class="string">&quot;美汁汁&quot;</span>)</span><br><span class="line"> <span class="number">72</span>             &#123;</span><br><span class="line"> <span class="number">73</span>                 Init.secret *= <span class="number">5</span>;</span><br><span class="line"> <span class="number">74</span>             &#125;</span><br><span class="line"> <span class="number">75</span>             <span class="keyword">else</span> <span class="keyword">if</span> (name == <span class="string">&quot;柠檬&quot;</span>)</span><br><span class="line"> <span class="number">76</span>             &#123;</span><br><span class="line"> <span class="number">77</span>                 Init.secret ^= <span class="number">87</span>;</span><br><span class="line"> <span class="number">78</span>             &#125;</span><br><span class="line"> <span class="number">79</span>             <span class="keyword">else</span> <span class="keyword">if</span> (name == <span class="string">&quot;汉堡顶&quot;</span> &amp;&amp; Init.spawnCount == <span class="number">5</span>)</span><br><span class="line"> <span class="number">80</span>             &#123;</span><br><span class="line"> <span class="number">81</span>                 Init.secret ^= <span class="number">127</span>;</span><br><span class="line"> <span class="number">82</span>                 <span class="built_in">string</span> str = Init.secret.ToString();</span><br><span class="line"> <span class="number">83</span>                 <span class="keyword">if</span> (ButtonSpawnFruit.Sha1(str) == <span class="string">&quot;DD01903921EA24941C26A48F2CEC24E0BB0E8CC7&quot;</span>)</span><br><span class="line"> <span class="number">84</span>                 &#123;</span><br><span class="line"> <span class="number">85</span>                     <span class="keyword">this</span>.result = <span class="string">&quot;BJDCTF&#123;&quot;</span> + ButtonSpawnFruit.Md5(str) + <span class="string">&quot;&#125;&quot;</span>;</span><br><span class="line"> <span class="number">86</span>                     Debug.Log(<span class="keyword">this</span>.result);</span><br><span class="line"> <span class="number">87</span>                 &#125;</span><br><span class="line"> <span class="number">88</span>             &#125;</span><br><span class="line"> <span class="number">89</span>             Init.spawnCount++;</span><br><span class="line"> <span class="number">90</span>             Debug.Log(Init.secret);</span><br><span class="line"> <span class="number">91</span>             Debug.Log(Init.spawnCount);</span><br><span class="line"> <span class="number">92</span>         &#125;</span><br><span class="line"> <span class="number">93</span>     &#125;</span><br><span class="line"> <span class="number">94</span> </span><br><span class="line"> <span class="number">95</span>     <span class="comment">// Token: 0x04000005 RID: 5</span></span><br><span class="line"> <span class="number">96</span>     <span class="keyword">public</span> GameObject toSpawn;</span><br><span class="line"> <span class="number">97</span> </span><br><span class="line"> <span class="number">98</span>     <span class="comment">// Token: 0x04000006 RID: 6</span></span><br><span class="line"> <span class="number">99</span>     <span class="keyword">public</span> <span class="keyword">int</span> spawnCount = <span class="number">1</span>;</span><br><span class="line"><span class="number">100</span> </span><br><span class="line"><span class="number">101</span>     <span class="comment">// Token: 0x04000007 RID: 7</span></span><br><span class="line"><span class="number">102</span>     <span class="keyword">public</span> AudioSource[] audioSources;</span><br><span class="line"><span class="number">103</span> </span><br><span class="line"><span class="number">104</span>     <span class="comment">// Token: 0x04000008 RID: 8</span></span><br><span class="line"><span class="number">105</span>     <span class="keyword">public</span> <span class="built_in">string</span> result = <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="number">106</span> &#125;</span><br></pre></td></tr></table></figure><p>经过SHa1加密得到<strong>DD01903921EA24941C26A48F2CEC24E0BB0E8CC7</strong>，经过解密就可以知道str=1001</p><p>再用MD5加密就可以得到b8c37e33defde51cf91e1e03e51657da</p><p>19行代码只取了20位，最后就可以得出flag</p><h1 id="WUSTCTF2020-Cr0ssfun"><a href="#WUSTCTF2020-Cr0ssfun" class="headerlink" title="[WUSTCTF2020]Cr0ssfun"></a>[WUSTCTF2020]Cr0ssfun</h1><p>找到主函数</p><p><img src="/2021/08/01/BUU-reverse3/fun9.PNG" alt="fun9"></p><p>要想跳出循环就要判断check这个函数，点进去看看</p><p><img src="/2021/08/01/BUU-reverse3/fun8.PNG" alt="fun8"></p><p>都是简单的判断，直接可以得出</p><h1 id="FlareOn6-Overlong"><a href="#FlareOn6-Overlong" class="headerlink" title="[FlareOn6]Overlong"></a>[FlareOn6]Overlong</h1><p>ida打开，主函数</p><p><img src="/2021/08/01/BUU-reverse3/long3.PNG" alt="long3"></p><p>第六行的函数，unk_402008的28位给Text,后面再用MessageBoxA输出text,运行试试</p><p> <img src="/2021/08/01/BUU-reverse3/long5.PNG" alt="long5"></p><p>输出中没有看到flag,看看unk_402008的数据</p><p><img src="/2021/08/01/BUU-reverse3/long4.PNG" alt="long4"></p><p>发现不止28个，有175个数据，就是AF</p><p>用OD打开</p><p><img src="/2021/08/01/BUU-reverse3/long1.PNG" alt="long1"></p><p>将压入栈的1C改为AF即可</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;BJDCTF2020-BJD-hamburger-competition&quot;&gt;&lt;a href=&quot;#BJDCTF2020-BJD-hamburger-competition&quot; class=&quot;headerlink&quot; title=&quot;[BJDCTF2020]BJD hamb</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>ReverseMe1</title>
    <link href="http://example.com/2021/07/27/ReverseMe1/"/>
    <id>http://example.com/2021/07/27/ReverseMe1/</id>
    <published>2021-07-27T04:02:07.000Z</published>
    <updated>2021-07-28T08:05:59.117Z</updated>
    
    <content type="html"><![CDATA[<h2 id="分析ReverseMe1"><a href="#分析ReverseMe1" class="headerlink" title="分析ReverseMe1"></a>分析ReverseMe1</h2><h2 id="一-运行"><a href="#一-运行" class="headerlink" title="一.运行"></a>一.运行</h2><p>打开程序，首先出现了一个Nag,都是废话没有什么用，点击确定，接下来是一个序列号的界面，要求我们输入Regcode。</p><p>两个目标：</p><p>1.删除消息框</p><p>2.寻找Regcode</p><p><img src="/2021/07/27/ReverseMe1/1.PNG" alt="1"></p><p><img src="/2021/07/27/ReverseMe1/2.PNG" alt="2"></p><h2 id="二-分析"><a href="#二-分析" class="headerlink" title="二.分析"></a>二.分析</h2><h3 id="1-去除消息框"><a href="#1-去除消息框" class="headerlink" title="1.去除消息框"></a>1.去除消息框</h3><p><img src="/2021/07/27/ReverseMe1/3.PNG" alt="3"></p><p>用OD打开，看一眼是非常熟悉的Visual Basic代码，猜一下，要调用消息框，要调用MtrcMsgBox函数，直接右键搜索函数</p><p><img src="/2021/07/27/ReverseMe1/4.PNG" alt="4"></p><p>找到调用函数的地方，发现一共有四处调用的地方，给他们下断点</p><p><img src="/2021/07/27/ReverseMe1/5.PNG" alt="5"></p><p>F9运行到第一个断点的地方，往上面再看看就可以看到Nag Screen的字眼，就是显示出来的消息框</p><p><img src="/2021/07/27/ReverseMe1/6.PNG" alt="6"></p><p>那我们要如何修改，才能让他不显示</p><p>本来想直接把call指令修改掉，都是栈内就乱了无法传回去</p><p>接着往上找找看看这段的首在哪里，找到了函数的开头，直接把他改成retn 0x4直接返回,不执行接下来的内容</p><p><img src="/2021/07/27/ReverseMe1/7.PNG" alt="7"></p><h3 id="2-寻找Regcode"><a href="#2-寻找Regcode" class="headerlink" title="2.寻找Regcode"></a>2.寻找Regcode</h3><p><img src="/2021/07/27/ReverseMe1/8.PNG" alt="8"></p><p>先随便输入一个看看是什么结果，看到是Sorry！、、、、通过这个字符串去寻找函数</p><p><img src="/2021/07/27/ReverseMe1/9.PNG" alt="9"></p><p><img src="/2021/07/27/ReverseMe1/10.PNG" alt="10"></p><p>这里就看到了一个I’mlena151，push到栈中，接下来调用了vbaStrCmp的函数，字面上就可以看出来这是一个比较的函数</p><p><img src="/2021/07/27/ReverseMe1/11.PNG" alt="11"></p><p>所以这就是我们要寻找的</p><p><img src="/2021/07/27/ReverseMe1/12.PNG" alt="12"></p><p>成功！</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;分析ReverseMe1&quot;&gt;&lt;a href=&quot;#分析ReverseMe1&quot; class=&quot;headerlink&quot; title=&quot;分析ReverseMe1&quot;&gt;&lt;/a&gt;分析ReverseMe1&lt;/h2&gt;&lt;h2 id=&quot;一-运行&quot;&gt;&lt;a href=&quot;#一-运行&quot; cla</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>BUU-reverse2</title>
    <link href="http://example.com/2021/07/25/BUU-reverse2/"/>
    <id>http://example.com/2021/07/25/BUU-reverse2/</id>
    <published>2021-07-25T02:13:49.000Z</published>
    <updated>2021-07-25T02:32:51.602Z</updated>
    
    <content type="html"><![CDATA[<h1 id="HDCTF2019-Maze"><a href="#HDCTF2019-Maze" class="headerlink" title="[HDCTF2019]Maze"></a>[HDCTF2019]Maze</h1><p>拖入ida后发现打不开，可能是加壳了，脱壳，成功打开。</p><p>找到main函数</p><p><img src="/2021/07/25/BUU-reverse2/%E8%8A%B1%E6%8C%87%E4%BB%A43.PNG" alt="花指令3"></p><p>发现没有办法反汇编，这里最后的应该jnz跳转到下面一行，就是个没有用的指令，下面一个的call明显出错了，没有这个地址，可以推断出这段代码添加了花指令，IDA分析失败了。D键转换成字节数据查看</p><p><img src="/2021/07/25/BUU-reverse2/%E8%8A%B1%E6%8C%87%E4%BB%A44.PNG" alt="花指令4"></p><p>发现 <code>db 0E8h</code>这条指令是添加的花指令，将其nop掉,接下来打开OD,找到要修改的地方</p><p><img src="/2021/07/25/BUU-reverse2/%E8%8A%B1%E6%8C%87%E4%BB%A41.PNG" alt="花指令1"></p><p>将JNZ和下面的db E8都改成NOP保存为新的程序，再打开IDA</p><p><img src="/2021/07/25/BUU-reverse2/%E8%8A%B1%E6%8C%87%E4%BB%A45.PNG" alt="花指令5"></p><p>可以看出这是一个迷宫题，找到存放迷宫图的地方</p><p><img src="/2021/07/25/BUU-reverse2/%E8%8A%B16.PNG" alt="花6"></p><p><img src="/2021/07/25/BUU-reverse2/%E8%8A%B17.PNG" alt="花7"><br> 用wasd控制行走，dword_408078控制左右，dword_40807C控制上下。<br> s是上，w是下，a是右，d是左。<br> 行走路径为ssaaasaassdddw<br> 则flag为<code>flag&#123;ssaaasaassdddw&#125;</code></p><h1 id="MRCTF2020-Xor"><a href="#MRCTF2020-Xor" class="headerlink" title="[MRCTF2020]Xor"></a>[MRCTF2020]Xor</h1><p>用IDA打开，发现不能反汇编，不知道是什么原因</p><p>看汇编的流程图</p><p><img src="/2021/07/25/BUU-reverse2/1.PNG" alt="1"></p><p>先看到第一个<strong>call sub_401050</strong>，这里压入了一个<strong>byte_4212C0</strong>和一个**%s<strong>，说明输入的flag最终会存放到</strong>byte_4212C0<strong>，继续往下看到</strong>loc_4010B6**这个段，关注edx，edx不断的在自增，最后出循环之后，与1Bh进行比较，大概就可以猜测edx存放的就是输入的flag的长度。<br><img src="/2021/07/25/BUU-reverse2/2.PNG" alt="2"></p><p>如果最后<strong>edx</strong>的值大于<strong>0x1b</strong>，流程就会往右走，直接提示Wrong！再看左边</p><p><img src="/2021/07/25/BUU-reverse2/3.PNG" alt="3"></p><p>将<strong>byte_4212c0</strong>的数据给了cl,把cl与al异或，再与<strong>byte_41EA08</strong>比较，不相等则输出错误，EAX再+1，eax再与edx比较大小，dx可以看到是存储的flag的长度，小于则继续循环</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">text=<span class="string">&#x27;MSAWB~FXZ:J:`tQJ&quot;N@ bpdd&#125;8g&#x27;</span></span><br><span class="line">flag=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(text)):</span><br><span class="line">flag+=<span class="built_in">chr</span>(i^<span class="built_in">ord</span>(text[i]))</span><br><span class="line"></span><br><span class="line">print(flag)</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;HDCTF2019-Maze&quot;&gt;&lt;a href=&quot;#HDCTF2019-Maze&quot; class=&quot;headerlink&quot; title=&quot;[HDCTF2019]Maze&quot;&gt;&lt;/a&gt;[HDCTF2019]Maze&lt;/h1&gt;&lt;p&gt;拖入ida后发现打不开，可能是加壳了，脱</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>分析abexcrackme2</title>
    <link href="http://example.com/2021/07/20/crackme2/"/>
    <id>http://example.com/2021/07/20/crackme2/</id>
    <published>2021-07-20T08:11:37.000Z</published>
    <updated>2021-07-22T12:17:57.245Z</updated>
    
    <content type="html"><![CDATA[<h1 id="1-abex‘crackme2"><a href="#1-abex‘crackme2" class="headerlink" title="1.abex‘crackme2"></a>1.abex‘crackme2</h1><h1 id="一-abex‘crackme2"><a href="#一-abex‘crackme2" class="headerlink" title="一.abex‘crackme2"></a>一.abex‘crackme2</h1><p>打开程序</p><p><img src="/2021/07/20/crackme2/1.PNG" alt="1"></p><p>要求我们输入名字与Serial，先随便输一个试试,点击check按钮，弹出了一个Wrong serial!的窗口，开始调试。</p><p><img src="/2021/07/20/crackme2/2.PNG" alt="2"></p><h1 id="二-VB专用引擎"><a href="#二-VB专用引擎" class="headerlink" title="二.VB专用引擎"></a>二.VB专用引擎</h1><p>VB文件使用名为MSVBVM60.dll ( Microsoft Visual Basic Virtual Machine 6.0 )的VB专用引擎(也称为The Thunder Runtime Engine )。<br>举个使用VB引擎的例子，显示消息框时，VB代码中要调用MsgBox)函数。其实，VB编辑器真正调用的是MSVBVM60.dll里的rtcMsgBox()函数，在该函数内部通过调用user32.dll里的MessageBoxW()函数(Win32 API）来工作（也可以在VB代码中直接调用user32.dll里的MessageBoxWO).</p><h1 id="三-开始调试"><a href="#三-开始调试" class="headerlink" title="三.开始调试"></a>三.开始调试</h1><p>运行OllyDbg,查看反汇编代码。</p><p><img src="/2021/07/20/crackme2/3.PNG" alt="3"></p><p>执行程序后，在EP代码中首先要做的是调用VB引擎的主函数（ThunRTMain() )。<br>EP的地址为401238。401238地址处的PUSH 401E14命令用来把RT_MainStruct结构体的地址( 401E14)压入栈。然后40123D地址处的CALL 00401232命令调用401232地址处的JMP DWORDPTR DS:[4010A0]指令。该JMP指令会跳转至VB引擎的主函数ThunRTMain()（前面压入栈的401E14的值作为ThunRTMain()的参数)。</p><h2 id="1-检索字符串"><a href="#1-检索字符串" class="headerlink" title="1.检索字符串"></a>1.检索字符串</h2><p><img src="/2021/07/20/crackme2/5.PNG" alt="5"></p><p>消息框的标题(“Wrong serial!”)、内容(“Nope，this serial is wrong!”)，还有实际调用消息框函数的代码(4034A6)都显示出来了。<br>从编程的观点来看，使用某种算法生成序列号，通过比较用户输入的序列号与字符串，代码分为TRUE(序列号相同）与FALSE(序列号不同)两大部分。换言之，上述代码的前后存在字符串比较代码,且序列号正确时程序代码会调用消息框输出成功消息.</p><p><img src="/2021/07/20/crackme2/6.PNG" alt="6"></p><p>调用403329地址的_vbaVarTstEq()函数，比较(TEST命令）返回值(AX)后，由403332地址的条件转移指令（JE指令）决定执行“真”代码还是“假”代码。</p><h2 id="2-查找字符串地址"><a href="#2-查找字符串地址" class="headerlink" title="2.查找字符串地址"></a>2.查找字符串地址</h2><p>调至403329处</p><p><img src="/2021/07/20/crackme2/7.PNG" alt="7"></p><p>有两个push，这时候我们查看栈窗口</p><p><img src="/2021/07/20/crackme2/8.PNG" alt="8"></p><p>可以看到地址0019F298，0019F288这两处。右键数据段查找</p><p><img src="/2021/07/20/crackme2/9.PNG" alt="9"></p><p>CCD8CAC8应该就是加密过的名字，sssss就是我们输入的serial，我们再用CCD8CAC8作为serial输入</p><p><img src="/2021/07/20/crackme2/11.PNG" alt="11"></p><h2 id="3-生成Serial的算法"><a href="#3-生成Serial的算法" class="headerlink" title="3.生成Serial的算法"></a>3.生成Serial的算法</h2><p>很显然,条件转移代码属于某个函数。该函数可能就是Check按钮的事件处理程序。原因在于选择Check按钮后，该函数会被调用执行，且含有用户代码来弹出成功/失败消息框。<br>最好倒着向上一点点地查找函数开始部分。向上拖动滚动条即可见到图8-14所示的代码。仔细看一下00402EDO地址处的命令。</p><p><img src="/2021/07/20/crackme2/12.PNG" alt="12"></p><p>上述代码是典型的栈帧代码，开始执行函数就会形成栈帧。由此得知该位置就是函数开始部分，即Check按钮的事件处理程序。</p><p>我们预测到程序使用VB引擎的API获取用户输入的字符串，下面以CALL指令为主进行调试(请注意观察此时传递给API的参数及返回值)。开始调试后，遇到第四条CALL指令，如下所示。</p><p><img src="/2021/07/20/crackme2/13.PNG" alt="13"></p><p>查看00402F8E地址处的代码可以看到，函数的局部对象SS:[EBP-88]地址传递(PUSH)给了函数的参数。</p><h3 id="加密方法"><a href="#加密方法" class="headerlink" title="加密方法"></a>加密方法</h3><p>(1)从给定的Name字符串前端逐一读取字符（共4次)。</p><p>(2)将字符转换为数字(ASCII代码)。</p><p>(3)向变换后的数字加64。</p><p>(4)再次将数字转换为字符。</p><p>(5)连接变换后的字符。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;1-abex‘crackme2&quot;&gt;&lt;a href=&quot;#1-abex‘crackme2&quot; class=&quot;headerlink&quot; title=&quot;1.abex‘crackme2&quot;&gt;&lt;/a&gt;1.abex‘crackme2&lt;/h1&gt;&lt;h1 id=&quot;一-abex‘crackm</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>BUU-reverse</title>
    <link href="http://example.com/2021/07/18/BUU-reverse/"/>
    <id>http://example.com/2021/07/18/BUU-reverse/</id>
    <published>2021-07-18T11:42:36.000Z</published>
    <updated>2021-07-18T13:02:43.916Z</updated>
    
    <content type="html"><![CDATA[<h1 id="【2019红帽杯】easyRE"><a href="#【2019红帽杯】easyRE" class="headerlink" title="【2019红帽杯】easyRE"></a>【2019红帽杯】easyRE</h1><p>直接IDA打开，搜索字符串找到一个you found me,进入sub_4009C6函数，先看到一个加密</p><p><img src="/2021/07/18/BUU-reverse/22.PNG" alt="22"></p><p>每个字符与索引异或判断是否相等，可以写一个脚本跑一下，结果发现不是，骗人的</p><p>运行结果：Info:The first four chars are ‘flag’</p><p>接着往下面看</p><p><img src="/2021/07/18/BUU-reverse/24.PNG" alt="24"></p><p><img src="/2021/07/18/BUU-reverse/23.PNG" alt="23"></p><p>发现是base64加密10次，判断是否与off_6cc90相等，base64解密十次得到了<a href="https://bbs.pediy.com/thread-254172.htm%EF%BC%8C%E6%B2%A1%E6%9C%89flag%EF%BC%8C%E9%83%BD%E6%98%AF%E6%B7%B7%E6%B7%86%E8%A7%86%E5%90%AC%E7%9A%84%EF%BC%8C%E7%9C%9F%E6%AD%A3%E7%9A%84%E8%97%8F%E5%9C%A8off_6cc90%E4%B8%8B%E9%9D%A2%E7%9A%84%E9%82%A3%E4%B8%AA%E6%95%B0%E6%8D%AE%E7%9A%84%E5%87%BD%E6%95%B0">https://bbs.pediy.com/thread-254172.htm，没有flag，都是混淆视听的，真正的藏在off_6cc90下面的那个数据的函数</a></p><p><img src="/2021/07/18/BUU-reverse/25.PNG" alt="25"><img src="/2021/07/18/BUU-reverse/26.PNG" alt="26"></p><p>首先用第20行的异或，102和103对应的字符分别是”f” 和”g”，而且byte_ <em>6CC0A0[0]和byte</em> _6CC0A3刚好<br>是一个字符串的第一位和第四位。那么可以想到是”flag” 与前四位异或，然后得到一个key,再进行下面for循<br>环的异或。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">s = [<span class="number">0x40</span>,<span class="number">0x35</span>,<span class="number">0x20</span>,<span class="number">0x56</span>,<span class="number">0x5D</span>,<span class="number">0x18</span>,<span class="number">0x22</span>,<span class="number">0x45</span>,<span class="number">0x17</span>,<span class="number">0x2F</span>,<span class="number">0x24</span>,<span class="number">0x6E</span>,<span class="number">0x62</span>,</span><br><span class="line">     <span class="number">0x3C</span>,<span class="number">0x27</span>,<span class="number">0x54</span>,<span class="number">0x48</span>,<span class="number">0x6C</span>,<span class="number">0x24</span>,<span class="number">0x6E</span>,<span class="number">0x72</span>,<span class="number">0x3C</span>,<span class="number">0x32</span>,<span class="number">0x45</span>,<span class="number">0x5B</span>]</span><br><span class="line">s1 = <span class="string">&#x27;flag&#x27;</span></span><br><span class="line">key = <span class="string">&#x27;&#x27;</span></span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">    key += <span class="built_in">chr</span>(s[k] ^ <span class="built_in">ord</span>(s1[k]))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(s)):</span><br><span class="line">    flag += <span class="built_in">chr</span>(s[i] ^ <span class="built_in">ord</span>(key[i%<span class="number">4</span>]))</span><br><span class="line">print(flag)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="ACTF新生赛2020-rome"><a href="#ACTF新生赛2020-rome" class="headerlink" title="[ACTF新生赛2020]rome"></a>[ACTF新生赛2020]rome</h1><p>拖进IDA，查看main函数</p><p><img src="/2021/07/18/BUU-reverse/actf1.PNG" alt="actf1"></p><p><img src="/2021/07/18/BUU-reverse/actf2.PNG" alt="actf2"></p><p>先判断了前面几位，再判断是不是大小写，然后运算</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">x = [<span class="number">81</span>,<span class="number">115</span>,<span class="number">119</span>,<span class="number">51</span>,<span class="number">115</span>,<span class="number">106</span>,<span class="number">95</span>,<span class="number">108</span>,<span class="number">122</span>,<span class="number">52</span>,<span class="number">95</span>,<span class="number">85</span>,<span class="number">106</span>,<span class="number">119</span>,<span class="number">64</span>,<span class="number">108</span>]</span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">16</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">127</span>):  </span><br><span class="line">        z = i</span><br><span class="line">        <span class="keyword">if</span> i &gt; <span class="number">64</span> <span class="keyword">and</span> i &lt;= <span class="number">90</span>:</span><br><span class="line">            i = (i-<span class="number">51</span>)%<span class="number">26</span> + <span class="number">65</span></span><br><span class="line">        <span class="keyword">if</span> i &gt; <span class="number">96</span> <span class="keyword">and</span> i &lt;= <span class="number">122</span>:</span><br><span class="line">            i = (i-<span class="number">79</span>)%<span class="number">26</span> + <span class="number">97</span></span><br><span class="line">        <span class="keyword">if</span>(i == x[k]):</span><br><span class="line">            flag += <span class="built_in">chr</span>(z)</span><br><span class="line"></span><br><span class="line">print(flag)</span><br></pre></td></tr></table></figure><h1 id="FlareOn4-login"><a href="#FlareOn4-login" class="headerlink" title="[FlareOn4]login"></a>[FlareOn4]login</h1><p>这是个前端验证flag的题目</p><p>题目给了一个提示</p><p><img src="/2021/07/18/BUU-reverse/login1.PNG" alt="login1"></p><p>直接查看源码</p><p><img src="/2021/07/18/BUU-reverse/login2.PNG" alt="login2"></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">String</span>.fromCharCode((c &lt;= <span class="string">&quot;Z&quot;</span> ? <span class="number">90</span> : <span class="number">122</span>) &gt;= (c = c.charCodeAt(<span class="number">0</span>) + <span class="number">13</span>) ? c : c - <span class="number">26</span>);</span><br></pre></td></tr></table></figure><p>关键的函数就是这一句，先判断大小写，与对应的Z或者z比较，大于减26，小于就原来的加上13的</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">enc = <span class="string">&#x27;PyvragFvqrYbtvafNerRnfl@syner-ba.pbz&#x27;</span></span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> enc:</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">ord</span>(i) &gt;= <span class="number">65</span> <span class="keyword">and</span> <span class="built_in">ord</span>(i) &lt;= <span class="number">90</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">ord</span>(i) - <span class="number">13</span> &lt; <span class="number">65</span> :</span><br><span class="line">            flag += <span class="built_in">chr</span>(<span class="built_in">ord</span>(i) + <span class="number">13</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            flag += <span class="built_in">chr</span>(<span class="built_in">ord</span>(i) - <span class="number">13</span>)</span><br><span class="line">    <span class="keyword">elif</span> <span class="built_in">ord</span>(i) &gt;= <span class="number">97</span> <span class="keyword">and</span> <span class="built_in">ord</span>(i) &lt;= <span class="number">122</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">ord</span>(i) - <span class="number">13</span> &lt; <span class="number">97</span> :</span><br><span class="line">            flag += <span class="built_in">chr</span>(<span class="built_in">ord</span>(i) + <span class="number">13</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            flag += <span class="built_in">chr</span>(<span class="built_in">ord</span>(i) - <span class="number">13</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        flag += i</span><br><span class="line"></span><br><span class="line">print(flag)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>最后的结果<a href="mailto:&#67;&#x6c;&#x69;&#x65;&#x6e;&#x74;&#83;&#x69;&#x64;&#101;&#76;&#x6f;&#103;&#x69;&#x6e;&#115;&#x41;&#x72;&#x65;&#69;&#97;&#115;&#x79;&#x40;&#102;&#x6c;&#97;&#114;&#101;&#x2d;&#111;&#x6e;&#46;&#x63;&#111;&#109;">&#67;&#x6c;&#x69;&#x65;&#x6e;&#x74;&#83;&#x69;&#x64;&#101;&#76;&#x6f;&#103;&#x69;&#x6e;&#115;&#x41;&#x72;&#x65;&#69;&#97;&#115;&#x79;&#x40;&#102;&#x6c;&#97;&#114;&#101;&#x2d;&#111;&#x6e;&#46;&#x63;&#111;&#109;</a>，与文件中的提示相对应</p><h1 id="GUET-CTF2019-re"><a href="#GUET-CTF2019-re" class="headerlink" title="[GUET-CTF2019]re"></a>[GUET-CTF2019]re</h1><p>查壳，发现有一个UPX壳</p><p><img src="/2021/07/18/BUU-reverse/re1.PNG" alt="re1"></p><p><img src="/2021/07/18/BUU-reverse/re2.PNG" alt="re2"></p><p><strong>代码分析</strong></p><p><img src="/2021/07/18/BUU-reverse/re3.PNG" alt="re3"></p><p>打开关键函数sub_4009AE</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">_BOOL8 __fastcall <span class="title">sub_4009AE</span><span class="params">(<span class="keyword">char</span> *a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">1629056</span> * *a1 != <span class="number">166163712</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">6771600</span> * a1[<span class="number">1</span>] != <span class="number">731332800</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">3682944</span> * a1[<span class="number">2</span>] != <span class="number">357245568</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">10431000</span> * a1[<span class="number">3</span>] != <span class="number">1074393000</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">3977328</span> * a1[<span class="number">4</span>] != <span class="number">489211344</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">5138336</span> * a1[<span class="number">5</span>] != <span class="number">518971936</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">7532250</span> * a1[<span class="number">7</span>] != <span class="number">406741500</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">5551632</span> * a1[<span class="number">8</span>] != <span class="number">294236496</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">3409728</span> * a1[<span class="number">9</span>] != <span class="number">177305856</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">13013670</span> * a1[<span class="number">10</span>] != <span class="number">650683500</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">6088797</span> * a1[<span class="number">11</span>] != <span class="number">298351053</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">7884663</span> * a1[<span class="number">12</span>] != <span class="number">386348487</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">8944053</span> * a1[<span class="number">13</span>] != <span class="number">438258597</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">5198490</span> * a1[<span class="number">14</span>] != <span class="number">249527520</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">4544518</span> * a1[<span class="number">15</span>] != <span class="number">445362764</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">3645600</span> * a1[<span class="number">17</span>] != <span class="number">174988800</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">10115280</span> * a1[<span class="number">16</span>] != <span class="number">981182160</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">9667504</span> * a1[<span class="number">18</span>] != <span class="number">493042704</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">5364450</span> * a1[<span class="number">19</span>] != <span class="number">257493600</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">13464540</span> * a1[<span class="number">20</span>] != <span class="number">767478780</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">5488432</span> * a1[<span class="number">21</span>] != <span class="number">312840624</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">14479500</span> * a1[<span class="number">22</span>] != <span class="number">1404511500</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">6451830</span> * a1[<span class="number">23</span>] != <span class="number">316139670</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">6252576</span> * a1[<span class="number">24</span>] != <span class="number">619005024</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">7763364</span> * a1[<span class="number">25</span>] != <span class="number">372641472</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">7327320</span> * a1[<span class="number">26</span>] != <span class="number">373693320</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">8741520</span> * a1[<span class="number">27</span>] != <span class="number">498266640</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">8871876</span> * a1[<span class="number">28</span>] != <span class="number">452465676</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">4086720</span> * a1[<span class="number">29</span>] != <span class="number">208422720</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">9374400</span> * a1[<span class="number">30</span>] == <span class="number">515592000</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">5759124</span> * a1[<span class="number">31</span>] == <span class="number">719890500</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>a1就是我们输入的v4，反向除就行,但是这里少了一个a7，需要去猜1-f</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">a1 = <span class="built_in">chr</span>(<span class="number">166163712</span> // <span class="number">1629056</span>)</span><br><span class="line">a2 = <span class="built_in">chr</span>(<span class="number">731332800</span> // <span class="number">6771600</span>)</span><br><span class="line">a3 = <span class="built_in">chr</span>(<span class="number">357245568</span> // <span class="number">3682944</span>)</span><br><span class="line">a4 = <span class="built_in">chr</span>(<span class="number">1074393000</span> // <span class="number">10431000</span>)</span><br><span class="line">a5 = <span class="built_in">chr</span>(<span class="number">489211344</span> // <span class="number">3977328</span>)</span><br><span class="line">a6 = <span class="built_in">chr</span>(<span class="number">518971936</span> // <span class="number">5138336</span>)</span><br><span class="line">a8 = <span class="built_in">chr</span>(<span class="number">406741500</span> // <span class="number">7532250</span>)</span><br><span class="line">a9 = <span class="built_in">chr</span>(<span class="number">294236496</span> // <span class="number">5551632</span>)</span><br><span class="line">a10 = <span class="built_in">chr</span>(<span class="number">177305856</span> // <span class="number">3409728</span>)</span><br><span class="line">a11 = <span class="built_in">chr</span>(<span class="number">650683500</span> // <span class="number">13013670</span>)</span><br><span class="line">a12 = <span class="built_in">chr</span>(<span class="number">298351053</span> // <span class="number">6088797</span>)</span><br><span class="line">a13 = <span class="built_in">chr</span>(<span class="number">386348487</span> // <span class="number">7884663</span>)</span><br><span class="line">a14 = <span class="built_in">chr</span>(<span class="number">438258597</span> // <span class="number">8944053</span>)</span><br><span class="line">a15 = <span class="built_in">chr</span>(<span class="number">249527520</span> // <span class="number">5198490</span>)</span><br><span class="line">a16 = <span class="built_in">chr</span>(<span class="number">445362764</span> // <span class="number">4544518</span>)</span><br><span class="line">a17 = <span class="built_in">chr</span>(<span class="number">981182160</span> // <span class="number">10115280</span>)</span><br><span class="line">a18 = <span class="built_in">chr</span>(<span class="number">174988800</span> // <span class="number">3645600</span>)</span><br><span class="line">a19 = <span class="built_in">chr</span>(<span class="number">493042704</span> // <span class="number">9667504</span>)</span><br><span class="line">a20 = <span class="built_in">chr</span>(<span class="number">257493600</span> // <span class="number">5364450</span>)</span><br><span class="line">a21 = <span class="built_in">chr</span>(<span class="number">767478780</span> // <span class="number">13464540</span>)</span><br><span class="line">a22 = <span class="built_in">chr</span>(<span class="number">312840624</span> // <span class="number">5488432</span>)</span><br><span class="line">a23 = <span class="built_in">chr</span>(<span class="number">1404511500</span> // <span class="number">14479500</span>)</span><br><span class="line">a24 = <span class="built_in">chr</span>(<span class="number">316139670</span> // <span class="number">6451830</span>)</span><br><span class="line">a25 = <span class="built_in">chr</span>(<span class="number">619005024</span> // <span class="number">6252576</span>)</span><br><span class="line">a26 = <span class="built_in">chr</span>(<span class="number">372641472</span> // <span class="number">7763364</span>)</span><br><span class="line">a27 = <span class="built_in">chr</span>(<span class="number">373693320</span> // <span class="number">7327320</span>)</span><br><span class="line">a28 = <span class="built_in">chr</span>(<span class="number">498266640</span> // <span class="number">8741520</span>)</span><br><span class="line">a29 = <span class="built_in">chr</span>(<span class="number">452465676</span> // <span class="number">8871876</span>)</span><br><span class="line">a30 = <span class="built_in">chr</span>(<span class="number">208422720</span> // <span class="number">4086720</span>)</span><br><span class="line">a31 = <span class="built_in">chr</span>(<span class="number">515592000</span> // <span class="number">9374400</span>)</span><br><span class="line">a32 = <span class="built_in">chr</span>(<span class="number">719890500</span> // <span class="number">5759124</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> (a1,a2,a3,a4,a5,a6,a8,a9,a10,a11,a12,a13,a14,a15,a16,a17,a18,a19,a20,a21,a22,a23,a24,a25,a26,a27,a28,a29,a30,a31,a32)</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;【2019红帽杯】easyRE&quot;&gt;&lt;a href=&quot;#【2019红帽杯】easyRE&quot; class=&quot;headerlink&quot; title=&quot;【2019红帽杯】easyRE&quot;&gt;&lt;/a&gt;【2019红帽杯】easyRE&lt;/h1&gt;&lt;p&gt;直接IDA打开，搜索字符串找到一个y</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>分析abex&#39;crackme1</title>
    <link href="http://example.com/2021/07/16/%E5%88%86%E6%9E%90crackme1/"/>
    <id>http://example.com/2021/07/16/%E5%88%86%E6%9E%90crackme1/</id>
    <published>2021-07-16T08:30:41.000Z</published>
    <updated>2021-07-19T07:55:11.024Z</updated>
    
    <content type="html"><![CDATA[<h1 id="一-abex’crackme1"><a href="#一-abex’crackme1" class="headerlink" title="一.abex’crackme1"></a>一.abex’crackme1</h1><p>调试前先运行abex’crackme #1这个程序，大致了解一下它。双击运行程序后弹出一个消息窗口,显示“Make me think your HD is a CD-Rom”消息。不太理解这句英文。消息的最后部分出现了“CD-Rom”这个词，我们只能根据它大致推测出前面的HD为HDD(Hard Disk Drive)的意思。由于没有更多选择，我们继续按消息窗口中的“确定”按钮。</p><p><img src="/2021/07/16/%E5%88%86%E6%9E%90crackme1/1.PNG" alt="1"></p><p>程序弹出Error消息窗后就终止运行了。但是abex到底想要干什么（要怎样破解什么）仍然不得而知。下面直接调试分析它，把握这个小程序的意图。</p><p><img src="/2021/07/16/%E5%88%86%E6%9E%90crackme1/2.PNG" alt="2"></p><h1 id="二-开始调试"><a href="#二-开始调试" class="headerlink" title="二.开始调试"></a>二.开始调试</h1><p><img src="/2021/07/16/%E5%88%86%E6%9E%90crackme1/3.PNG" alt="3"></p><p>由于代码非常简短,我们一点点地分析,重点看右上部分关于Win32 API调用的内容。如果之前大家从事过Windows应用程序的开发，那么对以上几个函数的含义应该非常了解。从上述代码的分析中，我们能够准确把握程序制作者的真正意图。在消息窗口按“确定”后，程序会调用GetDriveType() API，获取C驱动器的类型(大部分返回的是HDD类型)，然后操作它，使之被识别为CD-ROM类型,再在消息窗口中输出“OK, I really think that your HD is a CD-ROM!:p”消息。下面逐行分析crackme的代码。</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">;调用NessageBoxA()函数00401000 PUSH 0</span></span><br><span class="line"><span class="number">00404000</span> PUSH <span class="number">0</span>                 <span class="comment">;Style =MB_OKIMB_APPLMODAL</span></span><br><span class="line"><span class="number">00401002</span> PUSH <span class="number">402000</span>            <span class="comment">;Title = &quot;abex1st crackme”</span></span><br><span class="line"><span class="number">00401007</span> PUSH <span class="number">402012</span>            <span class="comment">;Text =“Make me think your HD is a CD-Rom.”</span></span><br><span class="line"><span class="number">0040100</span>c PUSH <span class="number">0</span>                 <span class="comment">; hOwner - NULL</span></span><br><span class="line"><span class="number">0040100</span>E CALL <span class="number">00401061</span>          <span class="comment">; MessageBoxA</span></span><br><span class="line">:在函数肉部ESI被设置为FFFFFFFF</span><br><span class="line"><span class="comment">;调用GetDriveType()函数</span></span><br><span class="line"><span class="number">00401013</span> PUSH <span class="number">402094</span><span class="comment">;RootPathName = &quot;c: 1”</span></span><br><span class="line"><span class="number">00401018</span> CALL <span class="number">00401055</span><span class="comment">; GetDriveTypeA</span></span><br><span class="line"><span class="comment">;返回值(EAX)是3(DRIVE_FIXED)</span></span><br><span class="line"><span class="number">0040101</span>D INC ESI<span class="comment">; ESI =0</span></span><br><span class="line"><span class="number">0040101</span>E DEC EAX<span class="comment">;EAX =2</span></span><br><span class="line"><span class="number">0040101</span>F <span class="keyword">JMP </span><span class="keyword">SHORT </span><span class="number">00401021</span></span><br><span class="line"><span class="number">00401021</span> INC ESI<span class="comment">;ESI = 1</span></span><br><span class="line"><span class="number">00401022</span> INC ESI<span class="comment">;ESI =2</span></span><br><span class="line"><span class="number">00401023</span> DEC EAX<span class="comment">;EAX=1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">;条件分支(401028或40103D)</span></span><br><span class="line"><span class="number">00401024</span> CMP EAX,ESI<span class="comment">;比较EAX(1)与EAX(2)</span></span><br><span class="line"><span class="number">00401026</span> <span class="keyword">JE </span><span class="keyword">SHORT </span><span class="number">0040103</span>D<span class="comment">;JE (Jump if Equal)条件分支命令;若两值相等,则跳转到40103D,</span></span><br><span class="line"><span class="comment">;若两值不等,则从401028继续执行;在40103D地址为消息框输出代码</span></span><br><span class="line"></span><br><span class="line"><span class="comment">;MessageBo×A()函数调用失败</span></span><br><span class="line"><span class="number">00401028</span> PUSH <span class="number">0</span><span class="comment">; Style = MB_OK|MB_APPLMODAL</span></span><br><span class="line"><span class="number">0040102</span>A PUSH <span class="number">402035</span><span class="comment">;Title = &quot;Error”</span></span><br><span class="line"><span class="number">0040102</span>F PUSH <span class="number">40203</span>B:Text -<span class="string">&quot;Nah. . . This is not a CD-ROM Drive!&quot;</span></span><br><span class="line"><span class="number">00401034</span> PUSH <span class="number">0</span><span class="comment">;hOwner - NULL</span></span><br><span class="line"><span class="number">00401036</span> CALL <span class="number">00401061</span><span class="comment">; MessageBoxA</span></span><br><span class="line"><span class="number">0040103</span>B <span class="keyword">JMP </span> <span class="keyword">SHORT </span><span class="number">00401050</span></span><br><span class="line"></span><br><span class="line"><span class="comment">;MessageBoxA(函数调用成功</span></span><br><span class="line"><span class="number">0040103</span>D PUSH <span class="number">0</span><span class="comment">;Style=MB_OKIMB_APPLMODAL</span></span><br><span class="line"><span class="number">0040103</span>F PUSH <span class="number">40205</span>E<span class="comment">; Title = &quot;YEAH!&quot;</span></span><br><span class="line"><span class="number">00401044</span> PUSH <span class="number">402064</span><span class="comment">;Text -&quot;Ok,Ireally think that your HDis a CD-ROM! :p”</span></span><br><span class="line"><span class="number">00401049</span> PUSH <span class="number">0</span><span class="comment">;hOwner = NULL</span></span><br><span class="line"><span class="number">0040104</span>B CALL <span class="number">00401061</span><span class="comment">;MessageBoxA</span></span><br><span class="line"></span><br><span class="line"><span class="comment">;终止进程</span></span><br><span class="line"><span class="number">00401050</span> CALL <span class="number">0040105</span>B<span class="comment">;ExitProcess</span></span><br></pre></td></tr></table></figure><p>可以看到就是通过比较AX和SI的值，等于就跳转，只需要把JE修改为无条件跳转指令JMP就可以了</p><p><img src="/2021/07/16/%E5%88%86%E6%9E%90crackme1/4.PNG" alt="4"></p><p>得到最后的结果。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;一-abex’crackme1&quot;&gt;&lt;a href=&quot;#一-abex’crackme1&quot; class=&quot;headerlink&quot; title=&quot;一.abex’crackme1&quot;&gt;&lt;/a&gt;一.abex’crackme1&lt;/h1&gt;&lt;p&gt;调试前先运行abex’crackme</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>BUU-CrackRTF</title>
    <link href="http://example.com/2021/07/15/BUU-CrackRTF/"/>
    <id>http://example.com/2021/07/15/BUU-CrackRTF/</id>
    <published>2021-07-15T03:01:18.000Z</published>
    <updated>2021-07-15T03:56:31.884Z</updated>
    
    <content type="html"><![CDATA[<h1 id="BUU-CrackRTF"><a href="#BUU-CrackRTF" class="headerlink" title="BUU-CrackRTF"></a>BUU-CrackRTF</h1><p>这道题太离谱了，很多没有见过的API，看不懂。</p><p><img src="/2021/07/15/BUU-CrackRTF/%E6%8D%95%E8%8E%B7.PNG" alt="捕获"></p><p>先查壳，发现是无壳的32位，丢进IDA,找到主函数</p><p><img src="/2021/07/15/BUU-CrackRTF/tempsnip.png" alt="tempsnip"></p><p>先输入了一段6个字符的字符串，再连上“@DBApp”,再进行加密，看一下加密函数</p><p><img src="/2021/07/15/BUU-CrackRTF/3.PNG" alt="3"></p><p>CryptCreateHash哈希加密，有了解过哈希的是可以知道，哈希是很多算法放在一起，然后随机抽一个算法来加密,这个0x8004u是什么看不懂，去查了一下winAPI文档才知道这个代表SHA1加密。</p><p>加密后与6E32D0943418C2C33385BC35A1470250DD8923A9对比，正确的话再进行。从前面的v4&lt;100000发现有范围限制，到1000000就可以了</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line">s = <span class="string">&#x27;6E32D0943418C2C33385BC35A1470250DD8923A9&#x27;</span>.lower()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100000</span>,<span class="number">1000000</span>):</span><br><span class="line">    a = <span class="built_in">str</span>(i)+<span class="string">&#x27;@DBApp&#x27;</span></span><br><span class="line">    m = hashlib.sha1()</span><br><span class="line">    m.update(a.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">    sha1 = m.hexdigest()</span><br><span class="line">    <span class="keyword">if</span> sha1 == s:</span><br><span class="line">        print(i)</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure><p><img src="/2021/07/15/BUU-CrackRTF/4.PNG" alt="4"></p><p>解出是123321</p><p>接下来输入第二串密码</p><p>也是先连接上第一个的密码在进行加密，但加密方式有点不太一样</p><p><img src="/2021/07/15/BUU-CrackRTF/5.PNG" alt="5"></p><p>换成了32位的MD5加密，后面却什么信息也都没有给，没有范围怎么爆破，这怎么搞。看了WP后发现是在下面一个函数里面加密</p><p><img src="/2021/07/15/BUU-CrackRTF/6.PNG" alt="6"></p><p>这里用了FindResourceA( )函数，详细可以看<a href="https://blog.csdn.net/singleyellow/article/details/80308789">https://blog.csdn.net/singleyellow/article/details/80308789</a></p><p>要用到Resource Hacker打开会有一个AAA的，从里面取出数据来</p><p><img src="/2021/07/15/BUU-CrackRTF/7.PNG" alt="7"></p><p>下面还有一个函数</p><p><img src="/2021/07/15/BUU-CrackRTF/8.PNG" alt="8"></p><p>将之前的输入的与AAA里面的异或，因为要生成一个.rtf的文件，那肯定缺少不了文件头。 直接搜索.rtf的文件头~</p><p>最后把文件头的前六位与AAA里面的六位做逆向异或，得到输入的密码</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">s = <span class="string">&quot;&#123;\rtf1&quot;</span></span><br><span class="line"></span><br><span class="line">a = [<span class="number">0x05</span>,<span class="number">0x7D</span>,<span class="number">0x41</span>,<span class="number">0x15</span>,<span class="number">0x26</span>,<span class="number">0x01</span>]</span><br><span class="line"></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(s)):</span><br><span class="line">x = <span class="built_in">ord</span>(s[i]) ^ a[i]</span><br><span class="line">flag += <span class="built_in">chr</span>(x)</span><br><span class="line">print(flag)</span><br></pre></td></tr></table></figure><p>得到第二次密码：<code>~!3a@0</code></p><p><img src="/2021/07/15/BUU-CrackRTF/9.PNG" alt="9"></p><p>得到flag</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;BUU-CrackRTF&quot;&gt;&lt;a href=&quot;#BUU-CrackRTF&quot; class=&quot;headerlink&quot; title=&quot;BUU-CrackRTF&quot;&gt;&lt;/a&gt;BUU-CrackRTF&lt;/h1&gt;&lt;p&gt;这道题太离谱了，很多没有见过的API，看不懂。&lt;/p&gt;
&lt;p</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>逆向分析Hello World！程序</title>
    <link href="http://example.com/2021/07/13/world/"/>
    <id>http://example.com/2021/07/13/world/</id>
    <published>2021-07-13T03:34:40.000Z</published>
    <updated>2021-07-13T12:52:08.896Z</updated>
    
    <content type="html"><![CDATA[<h1 id="1-Hello-World-程序"><a href="#1-Hello-World-程序" class="headerlink" title="1.Hello World!程序"></a>1.Hello World!程序</h1><p>这个程序想必大家都是非常熟悉的，第一个接触的程序一个就是他了，这里就不多加解释，用Visual C++编写</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;windows.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;tchar.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> _tmain(<span class="keyword">int</span> argc, TCHAR *argv[])</span><br><span class="line">&#123;</span><br><span class="line">MessageBox(<span class="literal">NULL</span>, </span><br><span class="line">   <span class="string">L&quot;Hello World!&quot;</span>, </span><br><span class="line">   <span class="string">L&quot;www.reversecore.com&quot;</span>, </span><br><span class="line">   MB_OK);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2021/07/13/world/25.PNG" alt="25"></p><h1 id="2-调试Hello-World-exe程序"><a href="#2-调试Hello-World-exe程序" class="headerlink" title="2.调试Hello World.exe程序"></a>2.调试Hello World.exe程序</h1><h2 id="调试目的"><a href="#调试目的" class="headerlink" title="调试目的"></a>调试目的</h2><p>通过调试Hello World.exe可执行文件，在转换得到的汇编语言中找到main()函数。</p><h2 id="开始调试"><a href="#开始调试" class="headerlink" title="开始调试"></a>开始调试</h2><p>首先用OllyDbg调试工具打开Hello World.exe程序</p><p><img src="/2021/07/13/world/2.PNG" alt="2"></p><h2 id="入口点"><a href="#入口点" class="headerlink" title="入口点"></a>入口点</h2><p>调试器停止的地方即为Hello World.exe执行的初始地址，它是一段EP（入口）代码，最重要的就是call 和jmp两个指令。call指令的作用是调用40270C地址处的函数，再跳转至40104F地址处。</p><h2 id="跟踪40270C函数"><a href="#跟踪40270C函数" class="headerlink" title="跟踪40270C函数"></a>跟踪40270C函数</h2><p>在4011A0地址处F7进去40270C函数</p><p><img src="/2021/07/13/world/3.PNG" alt="3"></p><p>可以看到它并不是main函数，在注释的API被调用的函数可以看到。</p><h2 id="跟踪40104F跳转语句"><a href="#跟踪40104F跳转语句" class="headerlink" title="跟踪40104F跳转语句"></a>跟踪40104F跳转语句</h2><p><img src="/2021/07/13/world/5.PNG" alt="4"></p><p>看到这一段代码是非常复杂的，他们是Visual C++的启动函数。跟踪这些代码就可以找到我们需要寻找的main()函数。</p><p>接下来一步步调试，先进入到402524函数</p><p><img src="/2021/07/13/world/6.PNG" alt="6"></p><p>这个函数也没有main()函数的特征，并没有在代码中发现调用MessageBox()API的代码。直接Ctrl+F9跳到retn,F7回到之前的地址继续按相同的方法走，</p><p><img src="/2021/07/13/world/7.PNG" alt="7"></p><p><img src="/2021/07/13/world/8.PNG" alt="8"></p><p>这里走到了401144这个地方，跳转进401000函数，发现401000函数内部出现了调用MessageBox()API的代码，该API函数的参数为“<a href="http://www.reversecore.com”与“helloworld!”两个字符串.与源码的内容一样,这就是要找的main函数/">www.reversecore.com”与“Helloworld!”两个字符串。与源码的内容一样，这就是要找的main函数</a></p><p><img src="/2021/07/13/world/9.PNG" alt="9"></p><h2 id="大本营"><a href="#大本营" class="headerlink" title="大本营"></a>大本营</h2><p>每次重新运行调试器时，调试都会返同到EP处，并从此处开始新的调试，使用起来相当不方便。经验丰富的代码逆向分析专家需要在调试代码时设置某个重要的点(地址)，使调试能快速转到设置点上。在代码中设置好这样的点后，再次调试时，调试流能够经过这些指定的点，快速达到目标。这些在代码中设置的点就像在登山途中设置的营帐样，以登喜马拉雅山为例，登顶过程中需要设置多个营帐充当据点，如“大木营”一“前进营1”一“前进营2”-“最终突击营”一“峰顶”。同样，调试代码量非常巨大时，整个调试过程可能需要好几天时间，那么在相应位置上设置这些“据点”将非常方便调试。下面向大家介绍几种在代码中设置“据点”的方法，并学习如何快速转到这些“据点”。首先运行OllyDbg,打开HelloWorld.exe可执行文件并调试，将40104F地址设置为basecamp (大本营)。</p><h2 id="设置方法"><a href="#设置方法" class="headerlink" title="设置方法"></a>设置方法</h2><p>​    1.Goto命令<br>请记住，我们要设置为“大本营”的地址为40104F。执行Go to(Ctrl+G)命令，打开一个Enterexpression to follow (输人跟踪表达式)对话框，如图2-11所示，在文本框中输人“40104F”，然后单击OK按钮。Enter expression to fllow</p><p><img src="/2021/07/13/world/10.PNG" alt="10"></p><p>输人地址单击OK按钮后，光标自动定位到40104F地址处，执行Execute till cursor(F4)命令，让调试流运行到该处，然后从40104F处开始调试代码就变得非常方便了。</p><p>​    2.设置断点<br>调试代码时，还可以设置BP ( Break Point,断点)(快捷键F2)让调试流转到“大本营”</p><p>​    3.注释</p><p><img src="/2021/07/13/world/11.PNG" alt="11"></p><p>​    4.标签</p><h2 id="快速查找指定代码的方法"><a href="#快速查找指定代码的方法" class="headerlink" title="快速查找指定代码的方法"></a>快速查找指定代码的方法</h2><h3 id="1代码执行法"><a href="#1代码执行法" class="headerlink" title="1代码执行法"></a>1代码执行法</h3><p>我们需要查找的是main)函数中调用MessageBox(函数的代码。在调试器中调试HelloWorld.exe ( Step Over(F8))时，main0函数的MessageBox(函数在某个时刻就会被调用执行，弹出消息对话框，显示“Hello World!”这条信息。以上就是代码执行法的基本原理，程序功能非常明确时,逐条执行指令来查找需要查找的位置。代码执行法仅适用于被调试的代码量不大、且程序功能明确的情况。倘若被调试的代码量很大且比较复杂时，此种方法就不再适用了。下面使用代码执行法来查找代码中的main0函数。从“大本营”( 40104F )开始，按F8键逐行执行命令,在某个时刻弹出消息对话框，显示”Hello World!”信息。按Ctrl+F2键再次载入待调试的可执行文件并重新调试，不断按F8键,某个时刻- -定会弹出消息对话框。弹出消息对话框时调用的函数即为main()函数。就是上面查找的方法。</p><h3 id="2-字符串检索法"><a href="#2-字符串检索法" class="headerlink" title="2.字符串检索法"></a>2.字符串检索法</h3><p>鼠标右键菜单- Search for - All referenced text strings</p><p>在程序中查找指定字符串的方法很多，这里向大家介绍OllyDbg中提供的字符串检索法。OllyDbg初次载入待调试的程序时，都会先经历-一个预分析过程。此过程中会查看进程内存，程序中引用的字符串和调用的API都会被摘录出来，整理到另外-一个列表中，这样的列表对调试是相当有用的。使用All referenced text strings命令会弹出一个窗口，其中列出了程序代码引用的字符串</p><p><img src="/2021/07/13/world/12.PNG" alt="12"></p><p>如图，地址401007处有个PUSH 004092A0的指令，通过该指令就可以到达字符串的位置。</p><h3 id="3-API检索法-1-在调用代码中设置断点"><a href="#3-API检索法-1-在调用代码中设置断点" class="headerlink" title="3 API检索法(1); 在调用代码中设置断点"></a>3 API检索法(1); 在调用代码中设置断点</h3><p>鼠标右键菜单- Search for - All intermodular calls<br>Windows编程中，若想向显示器显示内容，则需要使用Win 32 API向OS请求显示输出。换言之，应用程序向显示器画面输出内容时，需要在程序内部调用Win32 API。认真观察-一个程序的功能后,我们能够大致推测出它在运行时调用的Win32 API,若能进一步 查找到调用的Win32 API,则会为程序调试带来极大便利。以HelloWorld.exe为例， 它在运行时会弹出- -个消息窗口， 由此我们可以推断出该程序调用了user32.MessageBoxW0 API。<br><img src="/2021/07/13/world/13.PNG" alt="13"></p><p>可以看到MessageBoxW()的代码，该函数位于40100E地址处，它是user32.MessageBoxW()的API。</p><p>4.API检索法(2)：在API代码中设置断点</p><p>这种情况下，DLL代码库被加载到进程内存后,我们可以直接向DLL代码库添加断点。API是操作系统对用户应用程序提供的一系列函数， 它们实现于C:\Windowslsystems32文件夹中的dIl文件(如kermel32.dIl、user32.dl1、gdi32.dll、 advapi32.dI1、 ws2_ 32.dI等) 内部。简言之,我们编写的应用程序执行某种操作时(如各种I/O操作),必须使用OS提供的API向OS提出请求,然后与被调用API对应的系统DLL文件就会被加载到应用程序的进程内存。在OllyDbg菜单栏中依次选择View Memory菜单(快捷键Alt+M),打开内存映射窗口。如图所示，内存映射窗口中显示了- -部分HelloWorld.exe进程内存。在图底部的方框中可以看到，USER32库被加载到了内存。</p><p><img src="/2021/07/13/world/14.PNG" alt="14"></p><p>使用OllyDbg中的Name in all modules命令可以列出被加载的DLL文件中提供的所有API。使用Name in all modules命令打开All names窗口，单击Name栏目按名称排序，通过键盘敲出MessageBoxW后，光标会自动定位到MessageBoxW上。<br>USER32模块中有一个Export类型的MessageBoxW函数(不同系统环境下函数地址不同)。双击MessageBoxW函数后就会显示其代码，它实现于USER32.d1l库中，如图所示。</p><p><img src="/2021/07/13/world/world%5C16.PNG" alt="16"></p><p>观察MessageBoxW函数的地址空间可以发现,它与HelloWorld.exe使用的地址空间完全不同。在函数起始地址上按F2键，设置好断点后按F9继续执行.</p><p><img src="/2021/07/13/world/18.PNG" alt="18"></p><p>可以看到栈窗口中的信息和预测的一样，寄存器中的ESP的地址为19FF18</p><p><img src="/2021/07/13/world/17.PNG" alt="17"></p><p><img src="/2021/07/13/world/19.PNG" alt="19"></p><h1 id="3-利用“打补丁”修改字符串"><a href="#3-利用“打补丁”修改字符串" class="headerlink" title="3.利用“打补丁”修改字符串"></a>3.利用“打补丁”修改字符串</h1><p>先在我们之前找到的大本营处下断点，按F9运行程序，到大本营这</p><h2 id="修改字符串的方法"><a href="#修改字符串的方法" class="headerlink" title="修改字符串的方法"></a>修改字符串的方法</h2><h3 id="（1）直接修改字符串缓冲区"><a href="#（1）直接修改字符串缓冲区" class="headerlink" title="（1）直接修改字符串缓冲区"></a>（1）直接修改字符串缓冲区</h3><p>MessageBoxW函数的字符串参数”Hello World!” 保存在地址4092A0处的一段缓冲区中， 只要修改这段内容，就可以修改MessageBoxW 函数显示出的字符串。在Dump窗口中按CtrI+G快捷键执行Go to命令，在弹出窗口中输人4092A0进人字符串缓冲区。然后使用鼠标选中4092A0地址处的字符串，按Ctrl+E快捷键打开编辑窗口，</p><p><img src="/2021/07/13/world/20.PNG" alt="20"></p><p><img src="/2021/07/13/world/21.PNG" alt="21"></p><p>在返回去看断点的地方，已经被修改了</p><p><img src="/2021/07/13/world/22.PNG" alt="22"></p><p><img src="/2021/07/13/world/23.PNG" alt="23"></p><h3 id="（2）-在其他内存区域新建字符串并传递给消息函数"><a href="#（2）-在其他内存区域新建字符串并传递给消息函数" class="headerlink" title="（2）.在其他内存区域新建字符串并传递给消息函数"></a>（2）.在其他内存区域新建字符串并传递给消息函数</h3><p>401007地址处有- - 条PUSH 004092A0命令，它把4092A0地址处的“Hello World!”字符串以参数形式传递给MessageBoxW(函数。向MessageBox W0函数传递字符串参数时，传递的是字符串所在区域的首地址。如果改变了字符串地址，消息框就会显示变更后的字符串。在内存的某个区域新建一个长字符串, 并把新字符串的首地址传递给MessageBoxW0函数，可以认为传递的是完全不同的字符串地址。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;1-Hello-World-程序&quot;&gt;&lt;a href=&quot;#1-Hello-World-程序&quot; class=&quot;headerlink&quot; title=&quot;1.Hello World!程序&quot;&gt;&lt;/a&gt;1.Hello World!程序&lt;/h1&gt;&lt;p&gt;这个程序想必大家都是非常熟悉</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>大小端存储</title>
    <link href="http://example.com/2021/07/10/%E5%A4%A7%E5%B0%8F%E7%AB%AF%E5%AD%98%E5%82%A8/"/>
    <id>http://example.com/2021/07/10/%E5%A4%A7%E5%B0%8F%E7%AB%AF%E5%AD%98%E5%82%A8/</id>
    <published>2021-07-10T12:07:05.000Z</published>
    <updated>2021-07-10T12:33:43.116Z</updated>
    
    <content type="html"><![CDATA[<h1 id="一、大端模式和小端模式的起源"><a href="#一、大端模式和小端模式的起源" class="headerlink" title="一、大端模式和小端模式的起源"></a>一、大端模式和小端模式的起源</h1><p>​    关于大端小端名词的由来，有一个有趣的故事，来自于Jonathan Swift的《格利佛游记》：Lilliput和Blefuscu这两个强国在过去的36个月中一直在苦战。战争的原因：大家都知道，吃鸡蛋的时候，原始的方法是打破鸡蛋较大的一端，可以那时的皇帝的祖父由于小时侯吃鸡蛋，按这种方法把手指弄破了，因此他的父亲，就下令，命令所有的子民吃鸡蛋的时候，必须先打破鸡蛋较小的一端，违令者重罚。然后老百姓对此法令极为反感，期间发生了多次叛乱，其中一个皇帝因此送命，另一个丢了王位，产生叛乱的原因就是另一个国家Blefuscu的国王大臣煽动起来的，叛乱平息后，就逃到这个帝国避难。据估计，先后几次有11000余人情愿死也不肯去打破鸡蛋较小的端吃鸡蛋。这个其实讽刺当时英国和法国之间持续的冲突。Danny Cohen一位网络协议的开创者，第一次使用这两个术语指代字节顺序，后来就被大家广泛接受。</p><h1 id="二、什么是大端和小端"><a href="#二、什么是大端和小端" class="headerlink" title="二、什么是大端和小端"></a>二、什么是大端和小端</h1><p>大端和小端是指数据在内存中的存储模式，它由 CPU 决定：</p><ol><li><p>大端模式（Big-endian）是指将数据的低位（比如 1234 中的 34 就是低位）放在内存的高地址上，而数据的高位（比如 1234 中的 12 就是高位）放在内存的低地址上。这种存储模式有点儿类似于把数据当作字符串顺序处理，地址由小到大增加，而数据从高位往低位存放。</p></li><li><p>小端模式（Little-endian）是指将数据的低位放在内存的低地址上，而数据的高位放在内存的高地址上。这种存储模式将地址的高低和数据的大小结合起来，高地址存放数值较大的部分，低地址存放数值较小的部分，这和我们的思维习惯是一致，比较容易理解。</p></li></ol><p>举一个例子，比如数字0x12 34 56 78</p><p>大端序</p><p><strong>低地址 ——————–&gt; 高地址</strong><br><strong>0x12  |  0x34  |  0x56  |  0x78</strong></p><p>小端序</p><p><strong>低地址 ——————–&gt; 高地址</strong><br><strong>0x78  |  0x56  |  0x34  |  0x12</strong></p><p><img src="/2021/07/10/%E5%A4%A7%E5%B0%8F%E7%AB%AF%E5%AD%98%E5%82%A8/1.PNG" alt="1"></p><p>在计算机系统中，我们是以字节为单位的，每个地址单元都对应着一个字节，一个字节为8bit。但是在C语言中除了8bit的char之外，还有16bit的short型，32bit的long型（要看具体的编译器），另外，对于位数大于8位的处理器，例如16位或者32位的处理器，由于寄存器宽度大于一个字节，那么必然存在着一个如果将多个字节安排的问题。因此就导致了大端存储模式和小端存储模式。例如一个16bit的short型x，在内存中的地址为0x0010，x的值为0x1122，那么0x11为高字节，0x22为低字节。对于大端模式，就将0x11放在低地址中，即0x0010中，0x22放在高地址中，即0x0011中。小端模式，刚好相反。我们常用的X86结构是小端模式，而KEIL C51则为大端模式。很多的ARM，DSP都为小端模式。有些ARM处理器还可以由硬件来选择是大端模式还是小端模式。</p><h2 id="判断方法"><a href="#判断方法" class="headerlink" title="判断方法"></a>判断方法</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> x = <span class="number">0x01234567</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="keyword">sizeof</span>(<span class="keyword">int</span>); i++)</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%.2x &quot;</span>, ((<span class="keyword">char</span> *)&amp;x)[i]);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span> (((<span class="keyword">char</span> *)&amp;x)[<span class="number">0</span>] == <span class="number">0x67</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;little endian!\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (((<span class="keyword">char</span> *)&amp;x)[<span class="number">0</span>] == <span class="number">0x01</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;big endian\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;一、大端模式和小端模式的起源&quot;&gt;&lt;a href=&quot;#一、大端模式和小端模式的起源&quot; class=&quot;headerlink&quot; title=&quot;一、大端模式和小端模式的起源&quot;&gt;&lt;/a&gt;一、大端模式和小端模式的起源&lt;/h1&gt;&lt;p&gt;​    关于大端小端名词的由来，有一个有趣</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>BUU-luck_guy</title>
    <link href="http://example.com/2021/07/08/BUU-luck-guy/"/>
    <id>http://example.com/2021/07/08/BUU-luck-guy/</id>
    <published>2021-07-08T01:45:43.000Z</published>
    <updated>2021-07-08T02:37:34.460Z</updated>
    
    <content type="html"><![CDATA[<h1 id="GXYCTF2019-luck-guy"><a href="#GXYCTF2019-luck-guy" class="headerlink" title="GXYCTF2019 luck_guy"></a>GXYCTF2019 luck_guy</h1><p>拿到文件，先file一下，是64位的文件，直接拖进IDA64里面，找到主函数</p><p><img src="/2021/07/08/BUU-luck-guy/1.PNG" alt="1"></p><p>可以看到patch_me是关键的函数，输入的flag都要放到里面去</p><p><img src="/2021/07/08/BUU-luck-guy/2.PNG" alt="2"></p><p>继续跟进get_flag</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">unsigned</span> __int64 <span class="title">get_flag</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v0; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">int</span> i; <span class="comment">// [rsp+4h] [rbp-3Ch]</span></span><br><span class="line">  <span class="keyword">int</span> j; <span class="comment">// [rsp+8h] [rbp-38h]</span></span><br><span class="line">  __int64 s; <span class="comment">// [rsp+10h] [rbp-30h] BYREF</span></span><br><span class="line">  <span class="keyword">char</span> v5; <span class="comment">// [rsp+18h] [rbp-28h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v6; <span class="comment">// [rsp+38h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v6 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  v0 = time(<span class="number">0LL</span>);</span><br><span class="line">  srand(v0);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">4</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">switch</span> ( rand() % <span class="number">200</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;OK, it&#x27;s flag:&quot;</span>);</span><br><span class="line">        <span class="built_in">memset</span>(&amp;s, <span class="number">0</span>, <span class="number">0x28</span>uLL);</span><br><span class="line">        <span class="built_in">strcat</span>((<span class="keyword">char</span> *)&amp;s, f1);</span><br><span class="line">        <span class="built_in">strcat</span>((<span class="keyword">char</span> *)&amp;s, &amp;f2);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%s&quot;</span>, (<span class="keyword">const</span> <span class="keyword">char</span> *)&amp;s);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Solar not like you&quot;</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Solar want a girlfriend&quot;</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">        s = <span class="number">0x7F666F6067756369</span>LL;</span><br><span class="line">        v5 = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">strcat</span>(&amp;f2, (<span class="keyword">const</span> <span class="keyword">char</span> *)&amp;s);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">        <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt;= <span class="number">7</span>; ++j )</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">if</span> ( j % <span class="number">2</span> == <span class="number">1</span> )</span><br><span class="line">            *(&amp;f2 + j) -= <span class="number">2</span>;</span><br><span class="line">          <span class="keyword">else</span></span><br><span class="line">            --*(&amp;f2 + j);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;emmm,you can&#x27;t find flag 23333&quot;</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v6;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以看到有一个for循环和switch,进行了5次循环.case1很明显是对flag的最后处理，将f1和f2合并得到flag，点进去可以查看到                **f1     db ‘GXY{do_not_’**，f2初始值为空，接着往下看，case2和case3都没有什么有用的消息。case4是对f2的定义，这里是小端存储，所以f2要倒过来。case5则是对f2的处理。</p><p>case的顺序应该是case4,case5,case1.</p><p>按照逻辑直接写出脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">f1=<span class="string">&#x27;GXY&#123;do_not_&#x27;</span></span><br><span class="line">s0=<span class="string">&#x27;&lt;0x7F&gt;fo`guci&#x27;</span></span><br><span class="line">s=s0[::-<span class="number">1</span>]</span><br><span class="line">print(s)</span><br><span class="line">key=<span class="string">&quot;&quot;</span></span><br><span class="line">flag=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">    <span class="keyword">if</span> i%<span class="number">2</span>==<span class="number">1</span>:</span><br><span class="line">        key+=<span class="built_in">chr</span>(<span class="built_in">ord</span>(s[i])-<span class="number">2</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        key+=<span class="built_in">chr</span>(<span class="built_in">ord</span>(s[i])-<span class="number">1</span>)</span><br><span class="line">        i=s[i]</span><br><span class="line">flag=f1+key</span><br><span class="line">print(flag)</span><br></pre></td></tr></table></figure><p><img src="/2021/07/08/BUU-luck-guy/hexo\source_posts\BUU-luck-guy\3.PNG" alt="3"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;GXYCTF2019-luck-guy&quot;&gt;&lt;a href=&quot;#GXYCTF2019-luck-guy&quot; class=&quot;headerlink&quot; title=&quot;GXYCTF2019 luck_guy&quot;&gt;&lt;/a&gt;GXYCTF2019 luck_guy&lt;/h1&gt;&lt;p&gt;拿到</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>花指令</title>
    <link href="http://example.com/2021/06/14/%E8%8A%B1%E6%8C%87%E4%BB%A4/"/>
    <id>http://example.com/2021/06/14/%E8%8A%B1%E6%8C%87%E4%BB%A4/</id>
    <published>2021-06-14T08:05:21.000Z</published>
    <updated>2021-06-14T08:20:11.905Z</updated>
    
    <content type="html"><![CDATA[<h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><p>花指令是，由<a href="https://baike.baidu.com/item/%E8%AE%BE%E8%AE%A1%E8%80%85/514381">设计者</a>特别构思，希望使<a href="https://baike.baidu.com/item/%E5%8F%8D%E6%B1%87%E7%BC%96/10858476">反汇编</a>的时候出错，让破解者无法清楚正确地<a href="https://baike.baidu.com/item/%E5%8F%8D%E6%B1%87%E7%BC%96%E7%A8%8B%E5%BA%8F">反汇编程序</a>的内容，迷失方向。经典的是，目标位置是另一条指令的中间，这样在反汇编的时候便会出现混乱。花指令有可能利用各种指令：<a href="https://baike.baidu.com/item/jmp/2149772">jmp</a>, call, ret的一些<a href="https://baike.baidu.com/item/%E5%A0%86%E6%A0%88/1682032">堆栈</a>技巧，位置运算，等等。</p><p>花指令的作用是对付静态分析，以下面一段程序说明一下花指令的原理</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   _asm</span><br><span class="line">    &#123;</span><br><span class="line">            jmp l2</span><br><span class="line">        _EMIT <span class="number">0x1</span><span class="comment">//这里就是花指令</span></span><br><span class="line">        _EMIT <span class="number">0x2</span><span class="comment">//这里就是花指令</span></span><br><span class="line">        _EMIT <span class="number">0x3</span><span class="comment">//这里就是花指令</span></span><br><span class="line">        _EMIT <span class="number">0x4</span><span class="comment">//这里就是花指令</span></span><br><span class="line">l2:</span><br><span class="line">        mov eax,<span class="number">0x11111111</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  可以看到，程序直接跳转到标签l2了，在jmp指令和l2之间的就是花指令，花指令为什么能起作用呢？那是因为反编译器在反编译的时候不会像我们人一样去理解jmp和l2之间的指令是永远不会执行到的，所以在反编译的时候就把这段乱七八糟的代码作为正常的指令了，而这样的反编译会影响mov eax,0x11111111这个指令的正确识别，所以导致在OD中以上代码不会正确显示。</p><p>了解了原理我们就可以自如地设计花指令了，比如再加一段_EMIT 0x5等等。</p><p>花指令不光是能够用jmp指令来设计，还可以用call指令配合ret指令来进行设计，原理是这样的：我们知道call指令等于这样两条指令，一是把自身所在位置的下一条指令的地址压入堆栈，二是jmp到call的地址处，而ret指令可以理解为jmp到call指令压入堆栈的地址，因此，可以用call指令这样来写花指令：</p><p>1.call一个地址，在call下面随便写一点花指令，但是要注意一点与jmp版花指令不同的，我们要记得自己写的花指令占了多少个字节，比如，占了2字节，至于为什么要记得，往下看</p><p>2.在call里面，也就是函数里面，首先pop出压入的地址，然后把这个地址减去花指令占用的字节数，这里是2字节，再重新push进堆栈，然后就ret</p><p>这样，call结束以后执行的下一条指令就是我们想要去的位置了，也就是花指令下面的正常的指令了</p><p>其实用call来做的话起到的也就是jmp的作用，道理是一样的，只不过手法不同</p><p>这个call ret配合的方法是我分析aspack看到的，不知道还有没有其他的花指令的方法，有的话再加上：）</p><p>这里有个找花指令的小技巧，当发现jmp或者call的地址在OD中没显示的话，就把jmp或者call指令的下一个指令nop掉吧，肯定是花指令，如果还没有显示的话就继续nop下一条，直到显示的指令和执行的指令一致，所以说，去花指令是个体力活，哈哈</p><p>补充一点，如果这个call不跟进去的话，貌似程序就没办法调试了，不知道怎么回事，不清楚原因</p><p>  下边是一个用call ret实现花指令和跳转的例子：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    DWORD p;</span><br><span class="line">    _asm</span><br><span class="line">    &#123;</span><br><span class="line">        call l1</span><br><span class="line">l1:</span><br><span class="line">        pop eax</span><br><span class="line">        mov p,eax<span class="comment">//确定当前程序段的位置</span></span><br><span class="line">        call f1</span><br><span class="line">        _EMIT <span class="number">0xEA</span><span class="comment">//花指令，此处永远不会执行到</span></span><br><span class="line">        jmp l2<span class="comment">//call结束以后执行到这里</span></span><br><span class="line">f1:<span class="comment">//这里用F8OD会终止调试，F7跟进的话就正常,why?</span></span><br><span class="line">        pop ebx</span><br><span class="line">        inc ebx</span><br><span class="line">        push ebx</span><br><span class="line">        mov eax,<span class="number">0x11111111</span></span><br><span class="line">        ret</span><br><span class="line">l2:</span><br><span class="line">        call f2<span class="comment">//用ret指令实现跳转</span></span><br><span class="line">        mov ebx,<span class="number">0x33333333</span><span class="comment">//这里永远不会执行到</span></span><br><span class="line">        jmp e<span class="comment">//这里永远不会执行到</span></span><br><span class="line">f2:</span><br><span class="line">        mov ebx,<span class="number">0x11111111</span></span><br><span class="line">        pop ebx<span class="comment">//弹出压栈的地址</span></span><br><span class="line">        mov ebx,offset e<span class="comment">//要跳转到的地址</span></span><br><span class="line">        push ebx<span class="comment">//压入要跳转到的地址</span></span><br><span class="line">        ret<span class="comment">//跳转</span></span><br><span class="line">e:</span><br><span class="line">        mov ebx,<span class="number">0x22222222</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;hex&lt;&lt;p&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;原理&quot;&gt;&lt;a href=&quot;#原理&quot; class=&quot;headerlink&quot; title=&quot;原理&quot;&gt;&lt;/a&gt;原理&lt;/h2&gt;&lt;p&gt;花指令是，由&lt;a href=&quot;https://baike.baidu.com/item/%E8%AE%BE%E8%AE%A1%E8%80%8</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>BUU-刮开有奖</title>
    <link href="http://example.com/2021/06/10/BUU-%E5%88%AE%E5%BC%80%E6%9C%89%E5%A5%96/"/>
    <id>http://example.com/2021/06/10/BUU-%E5%88%AE%E5%BC%80%E6%9C%89%E5%A5%96/</id>
    <published>2021-06-10T08:00:56.000Z</published>
    <updated>2021-06-10T08:47:54.987Z</updated>
    
    <content type="html"><![CDATA[<h1 id="刮开有奖"><a href="#刮开有奖" class="headerlink" title="刮开有奖"></a>刮开有奖</h1><p><img src="/2021/06/10/BUU-%E5%88%AE%E5%BC%80%E6%9C%89%E5%A5%96/%E6%8D%95%E8%8E%B7.PNG" alt="捕获"></p><p>查壳发现是一个32位无壳</p><p>进入WINMain主函数<img src="/2021/06/10/BUU-%E5%88%AE%E5%BC%80%E6%9C%89%E5%A5%96/1.PNG" alt="1"></p><p>关键点在于DialogFunc函数里面，进去查看</p><p><img src="/2021/06/10/BUU-%E5%88%AE%E5%BC%80%E6%9C%89%E5%A5%96/2.PNG" alt="2"></p><p>看一遍下来通过代码<strong>GetDlgItemTextA(hDlg, 1000, &amp;String, 0xFFFF);</strong><br>知道了String是我们输入的flag。通过代码**if ( strlen(&amp;String) == 8 )**，我们知道flag的长度应该是8。再从上往下慢慢分析，先给V7-V17赋值，进入函数sub_4010F0</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __cdecl <span class="title">sub_4010F0</span><span class="params">(<span class="keyword">int</span> a1, <span class="keyword">int</span> a2, <span class="keyword">int</span> a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> result; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">int</span> i; <span class="comment">// esi</span></span><br><span class="line">  <span class="keyword">int</span> v5; <span class="comment">// ecx</span></span><br><span class="line">  <span class="keyword">int</span> v6; <span class="comment">// edx</span></span><br><span class="line"></span><br><span class="line">  result = a3;</span><br><span class="line">  <span class="keyword">for</span> ( i = a2; i &lt;= a3; a2 = i )</span><br><span class="line">  &#123;</span><br><span class="line">    v5 = <span class="number">4</span> * i;</span><br><span class="line">    v6 = *(_DWORD *)(<span class="number">4</span> * i + a1);</span><br><span class="line">    <span class="keyword">if</span> ( a2 &lt; result &amp;&amp; i &lt; result )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">do</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">if</span> ( v6 &gt; *(_DWORD *)(a1 + <span class="number">4</span> * result) )</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">if</span> ( i &gt;= result )</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          ++i;</span><br><span class="line">          *(_DWORD *)(v5 + a1) = *(_DWORD *)(a1 + <span class="number">4</span> * result);</span><br><span class="line">          <span class="keyword">if</span> ( i &gt;= result )</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          <span class="keyword">while</span> ( *(_DWORD *)(a1 + <span class="number">4</span> * i) &lt;= v6 )</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="keyword">if</span> ( ++i &gt;= result )</span><br><span class="line">              <span class="keyword">goto</span> LABEL_13;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">if</span> ( i &gt;= result )</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          v5 = <span class="number">4</span> * i;</span><br><span class="line">          *(_DWORD *)(a1 + <span class="number">4</span> * result) = *(_DWORD *)(<span class="number">4</span> * i + a1);</span><br><span class="line">        &#125;</span><br><span class="line">        --result;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">while</span> ( i &lt; result );</span><br><span class="line">    &#125;</span><br><span class="line">LABEL_13:</span><br><span class="line">    *(_DWORD *)(a1 + <span class="number">4</span> * result) = v6;</span><br><span class="line">    sub_4010F0(a1, a2, i - <span class="number">1</span>);</span><br><span class="line">    result = a3;</span><br><span class="line">    ++i;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>发现是一个排序的函数，将前面赋值的十个数从小到大排序</p><p><img src="/2021/06/10/BUU-%E5%88%AE%E5%BC%80%E6%9C%89%E5%A5%96/4.PNG" alt="4"></p><p>点击查看V23</p><p><img src="/2021/06/10/BUU-%E5%88%AE%E5%BC%80%E6%9C%89%E5%A5%96/5.PNG" alt="5"></p><p>V23等于string[5],依次可以看出V24等等</p><p>*<em>v4 = (const char <em>)sub_401000(&amp;v26, strlen(&amp;v26));</em></em>，接下来继续看sub_401000</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">_BYTE *__cdecl <span class="title">sub_401000</span><span class="params">(<span class="keyword">int</span> a1, <span class="keyword">int</span> a2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v2; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">int</span> v3; <span class="comment">// esi</span></span><br><span class="line">  <span class="keyword">size_t</span> v4; <span class="comment">// ebx</span></span><br><span class="line">  _BYTE *v5; <span class="comment">// eax</span></span><br><span class="line">  _BYTE *v6; <span class="comment">// edi</span></span><br><span class="line">  <span class="keyword">int</span> v7; <span class="comment">// eax</span></span><br><span class="line">  _BYTE *v8; <span class="comment">// ebx</span></span><br><span class="line">  <span class="keyword">int</span> v9; <span class="comment">// edi</span></span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> v10; <span class="comment">// edx</span></span><br><span class="line">  <span class="keyword">int</span> v11; <span class="comment">// edi</span></span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> v12; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> v13; <span class="comment">// esi</span></span><br><span class="line">  _BYTE *result; <span class="comment">// eax</span></span><br><span class="line">  _BYTE *v15; <span class="comment">// [esp+Ch] [ebp-10h]</span></span><br><span class="line">  _BYTE *v16; <span class="comment">// [esp+10h] [ebp-Ch]</span></span><br><span class="line">  <span class="keyword">int</span> v17; <span class="comment">// [esp+14h] [ebp-8h]</span></span><br><span class="line">  <span class="keyword">int</span> v18; <span class="comment">// [esp+18h] [ebp-4h]</span></span><br><span class="line"></span><br><span class="line">  v2 = a2 / <span class="number">3</span>;</span><br><span class="line">  v3 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> ( a2 % <span class="number">3</span> &gt; <span class="number">0</span> )</span><br><span class="line">    ++v2;</span><br><span class="line">  v4 = <span class="number">4</span> * v2 + <span class="number">1</span>;</span><br><span class="line">  v5 = <span class="built_in">malloc</span>(v4);</span><br><span class="line">  v6 = v5;</span><br><span class="line">  v15 = v5;</span><br><span class="line">  <span class="keyword">if</span> ( !v5 )</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="built_in">memset</span>(v5, <span class="number">0</span>, v4);</span><br><span class="line">  v7 = a2;</span><br><span class="line">  v8 = v6;</span><br><span class="line">  v16 = v6;</span><br><span class="line">  <span class="keyword">if</span> ( a2 &gt; <span class="number">0</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v9 = <span class="number">0</span>;</span><br><span class="line">      v10 = <span class="number">0</span>;</span><br><span class="line">      v18 = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">do</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">if</span> ( v3 &gt;= v7 )</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        ++v10;</span><br><span class="line">        v9 = *(<span class="keyword">unsigned</span> __int8 *)(v3++ + a1) | (v9 &lt;&lt; <span class="number">8</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">while</span> ( v10 &lt; <span class="number">3</span> );</span><br><span class="line">      v11 = v9 &lt;&lt; <span class="number">8</span> * (<span class="number">3</span> - v10);</span><br><span class="line">      v12 = <span class="number">0</span>;</span><br><span class="line">      v17 = v3;</span><br><span class="line">      v13 = <span class="number">18</span>;</span><br><span class="line">      <span class="keyword">do</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">if</span> ( v10 &gt;= v12 )</span><br><span class="line">        &#123;</span><br><span class="line">          *((_BYTE *)&amp;v18 + v12) = (v11 &gt;&gt; v13) &amp; <span class="number">0x3F</span>;</span><br><span class="line">          v8 = v16;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">          *((_BYTE *)&amp;v18 + v12) = <span class="number">64</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        *v8++ = byte_407830[*((<span class="keyword">char</span> *)&amp;v18 + v12)];</span><br><span class="line">        v13 -= <span class="number">6</span>;</span><br><span class="line">        ++v12;</span><br><span class="line">        v16 = v8;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">while</span> ( v13 &gt; <span class="number">-6</span> );</span><br><span class="line">      v3 = v17;</span><br><span class="line">      <span class="keyword">if</span> ( v17 &gt;= a2 )</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      v7 = a2;</span><br><span class="line">    &#125;</span><br><span class="line">    v6 = v15;</span><br><span class="line">  &#125;</span><br><span class="line">  result = v6;</span><br><span class="line">  *v8 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2021/06/10/BUU-%E5%88%AE%E5%BC%80%E6%9C%89%E5%A5%96/7.PNG" alt="7"></p><p>看到这个就知道是熟悉的base64加密</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( String == v7 + <span class="number">34</span>                       <span class="comment">// sub_4010F0函数后的第一位等于51+34=85--&gt;&#x27;U&#x27;</span></span><br><span class="line">       &amp;&amp; <span class="built_in">string</span>[<span class="number">1</span>] == v11                   <span class="comment">// 第2位，等于v13,即sub_4010F0函数返回值的第5位值--&gt;&#x27;J&#x27; </span></span><br><span class="line">       &amp;&amp; <span class="number">4</span> * <span class="built_in">string</span>[<span class="number">2</span>] - <span class="number">141</span> == <span class="number">3</span> * v9</span><br><span class="line">       &amp;&amp; <span class="built_in">string</span>[<span class="number">3</span>] / <span class="number">4</span> == <span class="number">2</span> * (v14 / <span class="number">9</span>)</span><br><span class="line">       &amp;&amp; !<span class="built_in">strcmp</span>(v4, <span class="string">&quot;ak1w&quot;</span>)</span><br><span class="line">       &amp;&amp; !<span class="built_in">strcmp</span>(v5, <span class="string">&quot;V1Ax&quot;</span>) )</span><br></pre></td></tr></table></figure><p>看最后的一段代码</p><p>然后通过python脚本解密ak1w和V1Ax</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">str1 = <span class="string">&#x27;ak1w&#x27;</span></span><br><span class="line">str2 = <span class="string">&#x27;V1Ax&#x27;</span></span><br><span class="line">flag1 = base64.b64decode(str1)</span><br><span class="line">flag2 = base64.b64decode(str2)</span><br><span class="line">print(flag1)</span><br><span class="line">print(flag2)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>得到 jMp和WP1</p><p>上面第三行和第四行代码是比较 4*’x-141==3 *69 算出来x=87，是W</p><p>所以WP1在前面，flag就可以组合起来了</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;刮开有奖&quot;&gt;&lt;a href=&quot;#刮开有奖&quot; class=&quot;headerlink&quot; title=&quot;刮开有奖&quot;&gt;&lt;/a&gt;刮开有奖&lt;/h1&gt;&lt;p&gt;&lt;img src=&quot;/2021/06/10/BUU-%E5%88%AE%E5%BC%80%E6%9C%89%E5%A5%96</summary>
      
    
    
    
    
  </entry>
  
</feed>
